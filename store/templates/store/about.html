{% extends 'store/base.html' %}
{% load static %}

{% block content %}
<!-- Hero Section -->
<div class="about-hero">
    <div class="container-fluid">
        <div class="row align-items-center" style="min-height: 400px;">
            <div class="col-lg-6">
                <h1 class="hero-title mb-4">About Fishy Friend Aquatics</h1>
                <p class="text-gray" style="font-size: 1.1rem; line-height: 1.8;">
                    Welcome to Fishy Friend Aquatics, your premier destination for premium aquatic fishes. 
                    We specialize in providing the finest selection of exotic and rare fish species, 
                    carefully curated from trusted breeders worldwide.
                </p>
            </div>
            <div class="col-lg-6">
                <div class="about-image-container">
                    {# removed decorative fish icon to avoid watermark overlay on the hero background image #}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mission Section -->
<section class="section">
    <div class="container-fluid">
        <h2 class="section-heading mb-5">Our Mission</h2>
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card" style="height: 100%; padding: 30px;">
                    <div class="mb-3">
                        <i class="fas fa-bullseye" style="font-size: 2.5rem; color: var(--accent-blue);"></i>
                    </div>
                    <h4 class="text-white mb-3">Quality First</h4>
                    <p class="text-gray" style="line-height: 1.8;">
                        Our collection features hundreds of species across multiple categories and breeds. 
                        Each fish is carefully selected, ensuring quality, health, and beauty. We work only 
                        with certified breeders who maintain the highest standards.
                    </p>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card" style="height: 100%; padding: 30px;">
                    <div class="mb-3">
                        <i class="fas fa-heart" style="font-size: 2.5rem; color: var(--accent-blue);"></i>
                    </div>
                    <h4 class="text-white mb-3">Customer Satisfaction</h4>
                    <p class="text-gray" style="line-height: 1.8;">
                        Whether you're a seasoned aquarist or just beginning your journey, we have something 
                        special for everyone. Our team of experts is dedicated to providing you with healthy, 
                        beautiful fish and exceptional customer service.
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Services Section -->
{% if services %}
<section class="section services-section">
    <div class="container-fluid">
        <h2 class="section-heading mb-5">Our Services</h2>
        <div class="row">
            {% for service in services %}
            <div class="col-12 col-md-6 col-lg-4 mb-4">
                <div class="card service-card h-100 d-flex flex-column">
                    {% if service.image %}
                    <img src="{{ service.image.url }}" class="service-image-top" alt="{{ service.title }}">
                    {% else %}
                    <div class="service-image-placeholder"></div>
                    {% endif %}
                    <div class="card-body d-flex flex-column" style="padding: 22px;">
                        <div class="mb-2">&nbsp;</div>
                        <h4 class="text-white mb-2" style="font-size:1.15rem;">{{ service.title }}</h4>
                        <p class="text-gray service-desc mb-0" style="line-height:1.6;">{{ service.description }}</p>
                        <div class="mt-3">
                            <button type="button" class="btn btn-sm btn-outline-light readmore-btn" data-title="{{ service.title|escapejs }}" data-description="{{ service.description|escapejs }}" {% if service.image %}data-image="{{ service.image.url }}"{% else %}data-image=""{% endif %}>Read more</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function () {
    const LIMIT = 220; // characters to show before truncation
    // Prepare modal container (will be populated on demand)
    let modalEl = document.getElementById('servicePreviewModal');

    document.querySelectorAll('.service-card').forEach(function (card) {
        const descEl = card.querySelector('.service-desc');
        const btn = card.querySelector('.readmore-btn');
        if (!descEl) {
            if (btn) btn.style.display = 'none';
            return;
        }
        const full = descEl.textContent.trim();
        if (!full || full.length <= LIMIT) {
            if (btn) btn.style.display = 'none';
            return;
        }
        const truncated = full.slice(0, LIMIT).trim() + '...';
        descEl.dataset.full = full;
        descEl.dataset.truncated = truncated;
        descEl.textContent = truncated;

        if (btn) {
            btn.style.display = 'inline-block';
            btn.textContent = 'Read more';
            // Open modal with image, title and full description
            btn.addEventListener('click', function (ev) {
                ev.preventDefault();
                const title = btn.getAttribute('data-title') || '';
                const desc = descEl.dataset.full || '';
                const imgUrl = btn.getAttribute('data-image') || '';

                // Create modal if missing
                                        if (!modalEl) {
                                        modalEl = document.createElement('div');
                                        modalEl.id = 'servicePreviewModal';
                                        modalEl.className = 'modal fade';
                                        modalEl.tabIndex = -1;
                                        modalEl.setAttribute('aria-hidden', 'true');
                                        modalEl.innerHTML = `
                                            <div class="modal-dialog modal-dialog-centered modal-lg">
                                                <div class="modal-content bg-dark text-white">
                                                    <div class="modal-body text-center p-4">
                                                        <h3 class="service-preview-title mb-3"></h3>
                                                        <p class="service-preview-desc mb-0"></p>
                                                    </div>
                                                    <div class="modal-footer border-0 justify-content-center">
                                                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                        document.body.appendChild(modalEl);
                                }

                                // Populate modal (title + description only; image intentionally omitted)
                                const titleEl = modalEl.querySelector('.service-preview-title');
                                const descElModal = modalEl.querySelector('.service-preview-desc');
                                titleEl.textContent = title;
                                descElModal.textContent = desc;

                if (window.bootstrap && typeof bootstrap.Modal === 'function') {
                    const m = new bootstrap.Modal(modalEl);
                    m.show();
                } else {
                    // fallback: simple dialog
                    modalEl.style.display = 'block';
                }
            });
        }
    });
});
</script>

<style>
/* Modal content wrapping and centered layout for service preview */
#servicePreviewModal .service-preview-image img {
    /* image removed from modal; keep the rule harmless in case it's reintroduced */
    display: none;
}
#servicePreviewModal .service-preview-title {
    text-align: center;
    font-weight: 600;
    margin-bottom: 12px;
}
#servicePreviewModal .service-preview-desc {
    white-space: normal !important;
    overflow-wrap: anywhere;
    word-break: break-word;
    text-align: center;
    max-width: 820px;
    margin-left: auto;
    margin-right: auto;
}
#servicePreviewModal .modal-body { padding: 1.5rem; }
</style>

<!-- Contact Information -->
{% if contact %}
<section class="section contact-section">
    <div class="container-fluid">
        <h2 class="section-heading mb-5">Get In Touch</h2>
        <div class="row">
            <!-- Quick Actions -->
            <div class="col-lg-4 mb-4">
                <div class="card contact-card quick-card" style="padding:32px; height:100%;">
                    <h4 class="text-white mb-4"><i class="fas fa-hands-helping me-2" style="color:var(--accent-blue);"></i>Quick Contact</h4>
                    <div class="quick-actions d-grid gap-3 mb-4">
                        <a href="tel:{{ contact.phone_primary }}" class="btn btn-primary w-100"><i class="fas fa-phone-alt me-2"></i>Call Now</a>
                        {% if contact.whatsapp %}<a href="https://wa.me/{{ contact.whatsapp|cut:'+' }}" target="_blank" class="btn btn-success w-100"><i class="fab fa-whatsapp me-2"></i>WhatsApp</a>{% endif %}
                        <a href="mailto:{{ contact.email_support }}" class="btn btn-info w-100" style="--bs-btn-color:#fff;"><i class="fas fa-envelope me-2"></i>Email Support</a>
                        {% if contact.email_sales %}<a href="mailto:{{ contact.email_sales }}" class="btn btn-outline-light w-100"><i class="fas fa-envelope-open-text me-2"></i>Email Sales</a>{% endif %}
                    </div>
                    <div class="small text-gray">
                        <i class="fas fa-map-marker-alt me-2" style="color:var(--accent-blue);"></i>
                        {{ contact.city }}, {{ contact.country }}
                        <div class="mt-2"><a href="#full-address" class="text-decoration-none" style="color:var(--accent-blue);">View full address â†“</a></div>
                    </div>
                </div>
            </div>
            <!-- Full Address & Emails -->
            <div class="col-lg-4 mb-4">
                <div class="card contact-card" style="padding:32px; height:100%;" id="full-address">
                    <h4 class="text-white mb-3"><i class="fas fa-map-marker-alt me-2" style="color:var(--accent-blue);"></i>Address</h4>
                    <p class="text-gray" style="line-height:1.7;">
                        {{ contact.address_line1 }}<br>
                        {% if contact.address_line2 %}{{ contact.address_line2 }}<br>{% endif %}
                        {{ contact.city }}{% if contact.state %}, {{ contact.state }}{% endif %}<br>
                        {% if contact.postal_code %}{{ contact.postal_code }}<br>{% endif %}
                        {{ contact.country }}
                    </p>
                    <hr class="my-4" style="border-color:rgba(255,255,255,0.08);">
                    <h4 class="text-white mb-3"><i class="fas fa-phone-alt me-2" style="color:var(--accent-blue);"></i>Phones</h4>
                    <ul class="list-unstyled text-gray mb-0" style="line-height:1.6;">
                        <li>Primary: <a href="tel:{{ contact.phone_primary }}" class="text-decoration-none text-white">{{ contact.phone_primary }}</a></li>
                        {% if contact.phone_secondary %}<li>Secondary: <a href="tel:{{ contact.phone_secondary }}" class="text-decoration-none text-white">{{ contact.phone_secondary }}</a></li>{% endif %}
                    </ul>
                </div>
            </div>
            <!-- Hours & Social -->
            <div class="col-lg-4 mb-4">
                <div class="card contact-card" style="padding:32px; height:100%;">
                    <h4 class="text-white mb-3"><i class="fas fa-clock me-2" style="color:var(--accent-blue);"></i>Opening Hours</h4>
                    {% if contact.opening_hours %}
                        <pre class="text-gray" style="white-space:pre-wrap; font-family:inherit; line-height:1.6;">{{ contact.opening_hours }}</pre>
                    {% else %}
                        <p class="text-gray">Hours not set.</p>
                    {% endif %}
                    <hr class="my-4" style="border-color:rgba(255,255,255,0.08);">
                    <h4 class="text-white mb-3"><i class="fas fa-share-alt me-2" style="color:var(--accent-blue);"></i>Social</h4>
                    <div class="d-flex flex-wrap gap-2">
                        {% if contact.whatsapp %}<a href="https://wa.me/{{ contact.whatsapp|cut:'+' }}" class="btn btn-sm btn-outline-light" target="_blank" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>{% endif %}
                        {% if contact.facebook_url %}<a href="{{ contact.facebook_url }}" class="btn btn-sm btn-outline-light" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>{% endif %}
                        {% if contact.instagram_url %}<a href="{{ contact.instagram_url }}" class="btn btn-sm btn-outline-light" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>{% endif %}
                        {% if contact.twitter_url %}<a href="{{ contact.twitter_url }}" class="btn btn-sm btn-outline-light" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i></a>{% endif %}
                        {% if contact.youtube_url %}<a href="{{ contact.youtube_url }}" class="btn btn-sm btn-outline-light" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>{% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% if map_url %}
        <div class="row mt-2">
            <div class="col-12">
                <div class="card contact-card" style="padding:0; overflow:hidden;">
                    <iframe src="{{ map_url }}" width="100%" height="500" style="border:0;" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
        </div>
        {% else %}
        <div class="row mt-2">
            <div class="col-12">
                <div class="card contact-card d-flex align-items-center justify-content-center" style="min-height:300px;">
                    <div class="text-center">
                        <i class="fas fa-map-marked-alt" style="font-size:3rem; color:var(--accent-blue); opacity:.6;"></i>
                        <p class="text-gray mt-3">Map location not provided.</p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endif %}


<style>
.about-hero {
    /* Background image (no overlay) */
    background-image: url("{% static 'images/underwater.jpg' %}");
    background-repeat: no-repeat;
    background-position: center center;
    background-size: cover;
    padding: 80px 0;
    margin-bottom: 60px;
}

.about-image-container {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
}

.services-section {
    background: var(--darker-bg);
    padding: 80px 0;
}

.service-card {
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.service-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(30, 136, 229, 0.2);
}
.service-card {
    overflow: hidden;
    transition: transform 0.28s ease, box-shadow 0.28s ease;
    border: 1px solid rgba(255,255,255,0.03);
}
.service-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(30, 136, 229, 0.12);
}

.service-image-top {
    width: 100%;
    height: 180px;
    object-fit: cover;
}

.service-image-placeholder {
    width: 100%;
    height: 180px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(30, 136, 229, 0.06), rgba(100, 181, 246, 0.06));
}

.service-desc {
    /* allow normal wrapping of service descriptions */
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
}
html[data-theme='light'] .contact-card { background:#fff; border:1px solid var(--light-border); }

html[data-theme='light'] .about-hero {
    /* Light theme: use the same image without overlay */
    background-image: url("{% static 'images/underwater.jpg' %}");
}

html[data-theme='light'] .services-section {
    background: var(--light-surface);
}

html[data-theme='light'] .service-card {
    background: white;
}

html[data-theme='light'] .service-card:hover {
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

html[data-theme='light'] .service-image-placeholder {
    background: linear-gradient(135deg, rgba(25, 118, 210, 0.1), rgba(66, 165, 245, 0.1));
}

@media (max-width: 768px) {
    .about-hero {
        padding: 40px 0;
    }
    
    .services-section {
        padding: 40px 0;
    }
    
    .service-image-placeholder {
        min-height: 200px;
    }
}

/* Ensure Read more button is visible in light theme */
html[data-theme='light'] .readmore-btn {
    color: var(--accent-blue) !important;
    border-color: var(--accent-blue) !important;
    background: transparent !important;
}
html[data-theme='light'] .readmore-btn:hover {
    background: rgba(0,0,0,0.04) !important;
}
</style>
{% endblock %}
