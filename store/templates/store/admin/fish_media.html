{% extends 'store/base.html' %}
{% load static %}

{% block extra_css %}
<style>
  /* Scoped styles for fish media management page */
  .fish-media-management .card {
    background: var(--card-bg) !important;
    border: 1px solid var(--border-color) !important;
    box-shadow: 0 0 20px rgba(0,100,200,0.15) !important;
  }
  
  .fish-media-management .card-header {
    background: linear-gradient(135deg, rgba(30,136,229,0.2), rgba(21,101,192,0.2)) !important;
    border-bottom: 2px solid rgba(100,150,255,0.3) !important;
  }
  
  .fish-media-management .card-header h5 {
    color: #FFFFFF !important;
  }
  
  /* Form labels */
  .fish-media-management .form-label {
    color: #FFFFFF !important;
    font-weight: 500;
  }
  
  /* Form inputs */
  .fish-media-management input.form-control,
  .fish-media-management select.form-select,
  .fish-media-management input[type="file"],
  .fish-media-management textarea.form-control {
    background-color: rgba(15, 25, 40, 0.95) !important;
    color: #FFFFFF !important;
    border: 1px solid rgba(100,150,255,0.25) !important;
    border-radius: 8px;
  }
  
  .fish-media-management input.form-control:focus,
  .fish-media-management select.form-select:focus,
  .fish-media-management textarea.form-control:focus {
    background-color: rgba(20, 30, 45, 0.95) !important;
    color: #FFFFFF !important;
    border-color: #1E88E5 !important;
    box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.15) !important;
  }
  
  .fish-media-management input.form-control:valid,
  .fish-media-management select.form-select:valid,
  .fish-media-management input.form-control:invalid,
  .fish-media-management select.form-select:invalid {
    background-color: rgba(15, 25, 40, 0.95) !important;
    color: #FFFFFF !important;
  }
  
  .fish-media-management input.form-control::placeholder {
    color: rgba(255, 255, 255, 0.5) !important;
  }
  
  /* Autofill state override */
  .fish-media-management input:-webkit-autofill,
  .fish-media-management input:-webkit-autofill:hover,
  .fish-media-management input:-webkit-autofill:focus,
  .fish-media-management input:-webkit-autofill:active {
    -webkit-box-shadow: 0 0 0 30px rgba(15, 25, 40, 0.95) inset !important;
    -webkit-text-fill-color: #FFFFFF !important;
  }
  
  .fish-media-management .text-muted {
    color: rgba(255, 255, 255, 0.7) !important;
  }
  
  /* Media item cards */
  .fish-media-management .media-item-card {
    background: rgba(20,30,45,0.75) !important;
    border: 1px solid rgba(100,150,255,0.2) !important;
    box-shadow: 0 4px 12px rgba(0,100,255,0.15) !important;
    border-radius: 8px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .fish-media-management .media-item-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0,100,255,0.25) !important;
  }
  
  .fish-media-management .media-item-card .card-body {
    background: transparent !important;
  }
  
  .fish-media-management .media-item-card strong {
    color: #FFFFFF !important;
  }
  
  .fish-media-management .media-item-card .text-muted {
    color: rgba(255,255,255,0.7) !important;
  }
  
  /* Empty state */
  .fish-media-management .empty-state {
    background: rgba(20,30,45,0.55) !important;
    border: 2px dashed rgba(100,150,255,0.3) !important;
    border-radius: 12px;
    padding: 3rem 2rem;
  }
  
  .fish-media-management .empty-state i {
    color: var(--accent-blue);
  }
  
  .fish-media-management .empty-state h4 {
    color: #FFFFFF !important;
  }
  
  .fish-media-management .empty-state p {
    color: rgba(255,255,255,0.7) !important;
  }
  
  /* No preview area */
  .fish-media-management .no-preview-area {
    background: rgba(15,25,40,0.6) !important;
    border: 1px solid rgba(100,150,255,0.2) !important;
  }
  
  .fish-media-management .no-preview-area .text-muted {
    color: rgba(255,255,255,0.5) !important;
  }
</style>
{% endblock %}

{% block content %}
<section class="section fish-media-management">
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="section-heading" style="margin-bottom:0;">Manage Media: {{ fish.name }}</h2>
      <a href="{% url 'admin_fishes' %}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back to Fishes</a>
    </div>

    <div class="row">
      <div class="col-lg-5 mb-4">
        <div class="card h-100">
          <div class="card-header"><h5 style="margin:0;">Add Media</h5></div>
          <div class="card-body">
            <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
              {% csrf_token %}
              <div class="mb-3">
                <label class="form-label">Type</label>
                {{ form.media_type }}
              </div>
              <div class="mb-3">
                <label class="form-label">File (image/video)</label>
                {{ form.file }}
                <small class="text-muted d-block">Accepted: images (JPG/PNG), videos (MP4)</small>
              </div>
              <div class="mb-3">
                <label class="form-label">External URL (optional)</label>
                {{ form.external_url }}
                <small class="text-muted d-block">Provide YouTube/Vimeo URL for streaming instead of uploading.</small>
              </div>
              <div class="mb-3">
                <label class="form-label">Title (optional)</label>
                {{ form.title }}
              </div>
              <div class="mb-3">
                <label class="form-label">Display Order</label>
                {{ form.display_order }}
              </div>
              <button type="submit" class="btn btn-primary w-100"><i class="fas fa-plus"></i> Add Media</button>
            </form>
          </div>
        </div>
      </div>
      <div class="col-lg-7 mb-4">
        <div class="card h-100">
          <div class="card-header"><h5 style="margin:0;">Existing Media</h5></div>
          <div class="card-body">
            {% if media_items %}
            <div class="row g-3">
              {% for m in media_items %}
              <div class="col-md-6">
                <div class="card media-item-card h-100">
                  <div class="card-body p-2 d-flex flex-column">
                    {% if m.media_type == 'image' and m.source %}
                      <img src="{{ m.source }}" alt="{{ m.title|default:fish.name }}" style="width:100%; height:170px; object-fit:cover; border-radius:4px;">
                    {% elif m.media_type == 'video' and m.source %}
                      {% if 'youtube.com' in m.embed_url or 'youtu.be' in m.embed_url %}
                        <div class="ratio ratio-16x9">
                          <iframe src="{{ m.embed_url }}" title="video" allowfullscreen style="border:0;" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                      {% elif m.file %}
                        <video controls style="width:100%; height:170px; object-fit:cover; border-radius:4px;">
                          <source src="{{ m.embed_url }}" type="video/mp4">
                          Your browser does not support the video tag.
                        </video>
                      {% else %}
                        <a href="{{ m.embed_url }}" target="_blank" rel="noopener" class="btn btn-outline-primary btn-sm">Open Video</a>
                      {% endif %}
                    {% else %}
                      <div class="d-flex align-items-center justify-content-center no-preview-area" style="height:170px; border-radius:4px;">
                        <span class="text-muted">No preview</span>
                      </div>
                    {% endif %}
                    <div class="mt-2" style="flex:1;">
                      <strong style="font-size:0.9rem;">{{ m.title|default:'(Untitled)' }}</strong><br>
                      <small class="text-muted">Type: {{ m.media_type }} | Order: {{ m.display_order }}</small>
                    </div>
                    <div class="mt-2 d-flex justify-content-between">
                      <form method="POST" action="{% url 'admin_delete_fish_media' m.id %}" data-confirm="Delete this media?">
                        {% csrf_token %}
                        <button class="btn btn-danger btn-sm" type="submit"><i class="fas fa-trash"></i></button>
                      </form>
                      <a href="{% url 'admin_edit_fish_media' m.id %}" class="btn btn-primary btn-sm"><i class="fas fa-edit"></i></a>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
              <i class="fas fa-photo-video"></i>
              <h4>No media yet</h4>
              <p>Add images or videos using the form.</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
