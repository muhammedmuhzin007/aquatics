{% extends 'store/base.html' %}

{% block content %}
<section class="section">
    <div class="container-fluid">
        <h2 class="section-heading">Browse Our Collection</h2>
        
        <div>
            <div class="row g-0">
                <div class="col-12">
                    <input id="live-search" type="text" class="form-control form-control-lg search-large" name="search" value="{{ search_query }}"
                           placeholder="Search by name, description, breed..." autocomplete="off" style="width:100%;">
                </div>
            </div>
        </div>

        <div id="fish-results">
            {% include 'store/customer/_fish_grid.html' %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function(){
    const searchInput = document.getElementById('live-search');
    const resultsContainer = document.getElementById('fish-results');
    const clearBtn = document.getElementById('clear-search');
    let timeout = null;

    function fetchResults(query){
        const params = new URLSearchParams({search: query});
        fetch(window.location.pathname + '?' + params.toString(), {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(resp => resp.json())
        .then(data => {
            if (data && data.html !== undefined) {
                insertResults(data.html);
            }
        })
        .catch(err => {
            console.error('Live search error', err);
        });
    }

    if (searchInput) {
        searchInput.addEventListener('input', function(e){
            const q = this.value.trim();
            // debounce
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                fetchResults(q);
            }, 300);
        });
    }

    // Smoothly animate new results when received
    function insertResults(html) {
        resultsContainer.innerHTML = html;
        resultsContainer.classList.remove('fade-in');
        // force reflow to restart animation
        void resultsContainer.offsetWidth;
        resultsContainer.classList.add('fade-in');
    }
});
</script>
{% endblock %}
