{% extends 'store/base.html' %}
{% load static %}
{% load currency %}

{% block extra_css %}
<style>
.combo-thumb {
    height: 140px;
    background-size: cover;
    background-position: center;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.3);
    border: 2px solid rgba(255,255,255,0.08);
}
.combo-thumb-empty {
    background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(0,0,0,0.02));
    display: flex;
    align-items: center;
    justify-content: center;
}
.combo-banner-bg {
    position: absolute;
    inset: 0;
    display: block;
    padding: 0;
    overflow: hidden;
    border-radius: 16px;
    z-index: 0;
}

@media (max-width: 768px) {
    .combo-thumb { width: 90px; height: 90px; }
    .combo-banner-bg { padding: 0; }
}

/* Full-banner collage for combo offers */
.combo-collage {
    display: grid;
    /* Magazine-like mosaic: a large tile plus supporting tiles */
    grid-template-columns: 2fr 1fr 1fr;
    grid-template-rows: repeat(2, 1fr);
    gap: 10px;
    width: 100%;
    height: 100%;
    min-height: 360px;
}
.collage-cell {
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    border-radius: 10px;
    box-shadow: 0 10px 36px rgba(0,0,0,0.28);
    min-height: 120px;
    overflow: hidden;
}
.collage-empty {
    background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
}

/* Mosaic placement: make first tile large and span two rows/columns */
.collage-cell:nth-child(1) {
    grid-column: 1 / span 2;
    grid-row: 1 / span 2;
}
.collage-cell:nth-child(2) {
    grid-column: 3 / span 1;
    grid-row: 1 / span 1;
}
.collage-cell:nth-child(3) {
    grid-column: 3 / span 1;
    grid-row: 2 / span 1;
}
.collage-cell:nth-child(n+4) {
    /* Additional cells will flow into the grid; they will occupy available space below */
    grid-column: auto;
    grid-row: auto;
}

/* Split layout: when we want equal vertical slices across the banner */
.combo-collage.split-layout {
    /* Use flex so each image becomes a full-height vertical slice and fills the banner */
    display: flex;
    gap: 0;
    align-items: stretch;
    justify-content: stretch;
    min-height: 360px;
    width: 100%;
    border-radius: 16px;
    overflow: hidden; /* keep slices inside rounded banner */
}
.combo-collage.split-layout .collage-cell {
    flex: 1 1 0;
    height: 100%;
    min-height: inherit;
    background-size: cover;
    background-position: center;
    border-radius: 0; /* parent keeps rounding */
    box-shadow: none;
    transform: none !important;
    position: relative; /* needed for divider pseudo */
}
.combo-collage.split-layout .collage-cell:not(:last-child)::after {
    content: '';
    position: absolute;
    right: 0;
    top: 14px;
    bottom: 14px;
    width: 1px;
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.18));
    pointer-events: none;
}
.combo-collage.split-layout .collage-cell:hover { transform: scale(1.03); z-index: 2; }

/* Layered/rotated styling for a more 'stylish' collage look */
.collage-cell {
    transition: transform 0.35s ease, box-shadow 0.35s ease;
    will-change: transform;
}
.collage-cell:nth-child(odd) { transform: rotate(-1.5deg); }
.collage-cell:nth-child(even) { transform: rotate(1.5deg); }
.collage-cell:hover { transform: scale(1.03) rotate(0deg); box-shadow: 0 18px 40px rgba(0,0,0,0.45); }

/* A subtle dark overlay for combo banners to ensure text readability */
.offer-banner-item .combo-banner-bg::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.12));
    z-index: 0;
    border-radius: 16px;
    pointer-events: none;
}

/* Stronger background for text when combo banners are used */
.offer-banner-content.combo-content {
    position: absolute;
    left: 20px;
    top: 24px;
    /* keep the panel compact instead of stretching full height */
    bottom: auto;
    max-height: 260px;
    overflow: hidden;
    /* removed heavy dark background so image shows through */
    background: transparent;
    backdrop-filter: none;
    padding: 20px 22px;
    border-radius: 12px;
    /* make overlay compact so split images remain visible */
    width: min(36%, 720px);
    z-index: 4;
    color: #fff;
    box-shadow: none;
    /* keep text legible on varied images */
    text-shadow: 0 6px 18px rgba(0,0,0,0.6);
}

@media (max-width: 992px) {
    .offer-banner-content.combo-content { width: 100%; max-width: 100%; padding: 20px; }
}

@media (max-width: 992px) {
    .combo-collage { grid-template-columns: repeat(2, 1fr); }
    .collage-cell { min-height: 180px; }
}

@media (max-width: 576px) {
    .combo-collage { grid-template-columns: 1fr; }
    .collage-cell { min-height: 140px; border-radius: 6px; }
}

.offer-banner-bg {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transform: scale(1.1);
    transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 0;
}

.offer-banner-item.active .offer-banner-bg {
    transform: scale(1);
}

.offer-banner-item:hover .offer-banner-bg {
    transform: scale(1.08);
}

.offer-banner-overlay {
    position: absolute;
    inset: 0;
    /* stronger left-to-right gradient to preserve image visibility while improving text contrast */
    background: linear-gradient(90deg, rgba(0,0,0,0.62) 0%, rgba(0,0,0,0.36) 20%, rgba(0,0,0,0.12) 45%, rgba(0,0,0,0.0) 100%);
    z-index: 1;
    pointer-events: none;
}

/* Remove heavy overlay for combo banners so image is visible */
.offer-banner-item.combo-banner-item .offer-banner-overlay {
    background: transparent;
}

.offer-banner-content {
    position: relative;
    z-index: 5;
    padding: 56px 52px;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: white;
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) 0.2s,
                transform 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) 0.2s;
}

.offer-banner-item.active .offer-banner-content {
    opacity: 1;
    transform: translateY(0);
}

@keyframes slideInDown {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.offer-banner-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.offer-banner-badge {
    background: linear-gradient(135deg, rgba(239,83,80,0.95), rgba(244,67,54,0.95));
    padding: 12px 24px;
    border-radius: 999px;
    font-weight: 800;
    font-size: 0.85rem;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 6px 20px rgba(239,83,80,0.5);
    animation: badgePulse 2.2s ease-in-out infinite;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    backdrop-filter: blur(4px);
    border: 1px solid rgba(255,255,255,0.2);
}

/* Combo-specific badge color (uses accent blue) */
.offer-banner-content.combo-content .offer-banner-badge {
    background: rgba(var(--accent-blue-rgb, 30,136,229), 0.95);
    box-shadow: 0 6px 24px rgba(var(--accent-blue-rgb, 30,136,229), 0.28);
    animation: none;
}

@keyframes badgePulse {
    0%, 100% { box-shadow: 0 4px 16px rgba(239,83,80,0.4); }
    50% { box-shadow: 0 6px 24px rgba(239,83,80,0.6); }
}

@keyframes bannerGlow {
    0%, 100% { 
        border-color: rgba(25,118,210,0.3);
        box-shadow: 0 8px 32px rgba(0,0,0,0.15), 
                    0 0 20px rgba(25,118,210,0.3);
    }
    50% { 
        border-color: rgba(25,118,210,0.5);
        box-shadow: 0 8px 32px rgba(0,0,0,0.15), 
                    0 0 40px rgba(25,118,210,0.5);
    }
}

@keyframes boltBlink {
    0%, 100% { 
        opacity: 1;
        transform: scale(1);
    }
    50% { 
        opacity: 0.3;
        transform: scale(0.9);
    }
}

.offer-banner-top .fa-bolt {
    animation: boltBlink 1.5s ease-in-out infinite;
    display: inline-block;
}

.offer-banner-title {
    font-size: 3.5rem;
    font-weight: 900;
    margin-bottom: 16px;
    text-shadow: 0 6px 20px rgba(0,0,0,0.6);
    line-height: 1.15;
    letter-spacing: -1px;
    animation: slideInDown 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    opacity: 0;
}

.offer-banner-item.active .offer-banner-title {
    opacity: 1;
}

.offer-banner-title,
.offer-banner-discount,
.offer-banner-description,
.offer-banner-fish-info,
.offer-banner-end-date {
    color: #fff;
    text-shadow: 0 6px 18px rgba(0,0,0,0.6);
}

.offer-banner-discount {
    font-size: 2.5rem;
    font-weight: 900;
    color: #FFD600;
    margin-bottom: 16px;
    margin-top: 32px;
    text-shadow: 0 4px 16px rgba(255, 214, 0, 0.4);
    letter-spacing: -0.5px;
    animation: slideInDown 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    animation-delay: 0.3s;
    opacity: 0;
}

.offer-banner-item.active .offer-banner-discount {
    opacity: 1;
}

.offer-banner-item.active .offer-banner-discount {
    opacity: 1;
}

.offer-banner-description {
    font-size: 1.1rem;
    margin-bottom: 24px;
    opacity: 0.95;
    line-height: 1.6;
    max-width: 600px;
}

.offer-banner-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.offer-banner-end-date {
    font-size: 0.9rem;
    opacity: 0.9;
}

.offer-progress-container {
    margin-top: 24px;
    background: rgba(255,255,255,0.15);
    height: 6px;
    border-radius: 999px;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.offer-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #FFD600 0%, #FFA500 50%, #FF6B6B 100%);
    border-radius: 999px;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 0 16px rgba(255,214,0,0.8), inset 0 1px 2px rgba(255,255,255,0.3);
}

/* Compact banner for multiple offers */
.offer-banner-compact {
    min-height: 250px;
}

.offer-banner-compact .offer-banner-title {
    font-size: 2rem;
}

.offer-banner-compact .offer-banner-discount {
    font-size: 1.5rem;
}

.offer-banner-compact .offer-banner-content {
    padding: 32px;
}

/* Fallback solid color backgrounds */
.offer-banner-solid {
    background: linear-gradient(135deg, #1976D2 0%, #0D47A1 100%);
}

/* Carousel Navigation Arrows */
.offer-carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(135deg, rgba(30, 136, 229, 0.3), rgba(30, 136, 229, 0.2));
    border: 2px solid rgba(30, 136, 229, 0.6);
    color: white;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    z-index: 50;
    font-size: 1.3rem;
    backdrop-filter: blur(12px);
    outline: none;
    opacity: 1 !important;
    box-shadow: 0 8px 24px rgba(30, 136, 229, 0.25), inset 0 1px 2px rgba(255,255,255,0.2);
}

/* Ensure inline SVG chevrons in nav buttons are visible */
.offer-carousel-nav svg { 
    width: 22px; 
    height: 22px; 
    display: block; 
    color: white;
    transition: transform 0.3s ease;
}
.offer-carousel-nav svg path { 
    stroke: rgba(255,255,255,0.95); 
    stroke-width: 2.5; 
}

.offer-carousel-nav:hover {
    background: linear-gradient(135deg, rgba(30, 136, 229, 0.5), rgba(30, 136, 229, 0.4));
    transform: translateY(-50%) scale(1.15);
    box-shadow: 0 12px 32px rgba(30, 136, 229, 0.4), inset 0 1px 2px rgba(255,255,255,0.3);
    border-color: rgba(30, 136, 229, 0.8);
}

.offer-carousel-nav:hover svg {
    transform: scale(1.15);
}

.offer-carousel-nav:focus {
    outline: 2px solid rgba(30, 136, 229, 0.8);
    outline-offset: 4px;
}

/* Ensure nav buttons receive pointer events even if parent elements add overlays */
.offer-carousel-nav { pointer-events: auto; }

/* DEBUG: temporary outline to verify nav button click areas during testing */
.offer-carousel-nav.debug-outline {
    outline: 3px solid rgba(255,0,0,0.7);
    box-shadow: 0 0 0 6px rgba(255,0,0,0.08);
}
.offer-carousel-nav:hover {
    background: rgba(255, 255, 255, 0.4);
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

/* Reduce visual weight of nav when many slices are visible */
.offer-carousel-nav { opacity: 0.9; }

/* Small responsive tweaks */
@media (max-width: 992px) {
    .offer-banner-carousel { min-height: 300px; }
    .combo-collage.split-layout { min-height: 260px; }
    
    .offer-banner-title {
        font-size: 2.8rem;
    }
    
    .offer-banner-discount {
        font-size: 2rem;
    }
}

.offer-carousel-prev {
    left: 24px;
}

.offer-carousel-next {
    right: 24px;
}

/* Carousel Indicators */
.offer-carousel-indicators {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    z-index: 10;
}

.offer-carousel-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.4);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.offer-carousel-dot:hover {
    background: rgba(255, 255, 255, 0.6);
    transform: scale(1.2);
}

.offer-carousel-dot.active {
    background: white;
    width: 30px;
    border-radius: 5px;
}

@media (max-width: 768px) {
    .offer-banner-item,
    .offer-banner-carousel {
        min-height: 320px;
    }
    
    .offer-banner-title {
        font-size: 2.2rem;
        margin-bottom: 12px;
    }
    
    .offer-banner-discount {
        font-size: 1.8rem;
        margin-bottom: 12px;
    }
    
    .offer-banner-content {
        padding: 28px 20px;
    }
    
    .offer-banner-description {
        font-size: 1rem;
        margin-bottom: 16px;
    }
    
    .offer-carousel-nav {
        width: 48px;
        height: 48px;
        font-size: 1.1rem;
    }
    
    .offer-carousel-nav svg {
        width: 20px;
        height: 20px;
    }
    
    .offer-carousel-prev {
        left: 12px;
    }
    
    .offer-carousel-next {
        right: 12px;
    }
}

@media (max-width: 576px) {
    .offer-banner-carousel {
        min-height: 280px;
    }
    
    .offer-banner-title {
        font-size: 1.8rem;
    }
    
    .offer-banner-discount {
        font-size: 1.5rem;
    }
    
    .offer-banner-content {
        padding: 24px 16px;
    }
    
    .offer-carousel-nav {
        width: 44px;
        height: 44px;
        font-size: 1rem;
    }
}

/* Limited Offers carousel layout: stack slides and fade active */
.limited-offers-banner {
    background: transparent;
    padding: 8px 0; /* reduced vertical gap to bring banner closer to heading */
}

.offer-banner-carousel { 
    position: relative; 
    overflow: hidden; 
    min-height: 340px; /* slightly reduced height so vertical spacing feels tighter */
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.35), inset 0 1px 2px rgba(255,255,255,0.1);
}
.offer-banner-item { position: absolute; inset: 0; display: block; text-decoration: none; color: inherit; opacity: 0; pointer-events: none; transition: opacity 500ms ease; }
.offer-banner-item.active { opacity: 1; pointer-events: auto; z-index: 2; }
/* If a banner is marked hidden by logic, keep it non-interactive */
.offer-banner-item.offer-hidden { opacity: 0 !important; pointer-events: none !important; visibility: hidden; }

/* Light theme refinements */
.limited-offers {
    background: linear-gradient(145deg, rgba(30,40,60,0.9), rgba(15,25,45,0.95));
    border: 2px solid transparent;
    border-image: linear-gradient(135deg, rgba(30,136,229,0.3), rgba(100,181,246,0.2)) 1;
    border-radius: 12px;
    padding: 0;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 0 1px rgba(30,136,229,0.1);
    animation: borderGlow 3s ease-in-out infinite;
}

@keyframes borderGlow {
    0%, 100% { box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 20px rgba(30,136,229,0.1); }
    50% { box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 30px rgba(30,136,229,0.2); }
}

.limited-offers .lo-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 20px;
    background: linear-gradient(135deg, rgba(30,136,229,0.18), rgba(30,136,229,0.08));
    border-bottom: 1px solid rgba(30,136,229,0.2);
    backdrop-filter: blur(10px);
}

.limited-offers .lo-title {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 0;
    color: var(--text-white);
    font-weight: 700;
    font-size: 1.3rem;
    text-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.limited-offers .lo-title i {
    animation: pulse 2s ease-in-out infinite;
    filter: drop-shadow(0 0 8px rgba(255,193,7,0.6));
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.limited-offers .lo-body { padding: 20px; }

/* Enhanced Offer Cards */
.limited-offer-card {
    overflow: hidden;
    border-radius: 14px;
    border: 2px solid rgba(30,136,229,0.2) !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 20px rgba(0,0,0,0.25), 0 0 0 1px rgba(30,136,229,0.1);
    position: relative;
    min-height: 240px;
}

.limited-offer-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(30,136,229,0.1), transparent);
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 1;
    pointer-events: none;
}

.limited-offer-card:hover {
    transform: translateY(-8px) scale(1.02);
    border-color: rgba(30,136,229,0.5) !important;
    box-shadow: 0 12px 40px rgba(30,136,229,0.35), 0 0 0 1px rgba(30,136,229,0.3);
}

.limited-offer-card:hover::before {
    opacity: 1;
}

.limited-offer-card .overlay-top {
    position: absolute;
    inset: 0;
    /* Make the overlay subtle / transparent so category images are not heavily shaded */
    background: linear-gradient(180deg, rgba(0,0,0,0.05), rgba(0,0,0,0.08));
    z-index: 1;
}

.limited-offer-card .time-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 3;
    border-radius: 999px;
    padding: 8px 14px !important;
    font-weight: 600;
    font-size: 0.85rem;
    box-shadow: 0 4px 16px rgba(239,83,80,0.4);
    animation: badgePulse 2s ease-in-out infinite;
}

@keyframes badgePulse {
    0%, 100% { box-shadow: 0 4px 16px rgba(239,83,80,0.4); }
    50% { box-shadow: 0 6px 24px rgba(239,83,80,0.6); }
}

.limited-offer-card .card-body {
    position: relative;
    z-index: 2;
    padding: 24px !important;
}

.limited-offer-card .card-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 12px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.5);
}

/* Improve visibility for the small count text inside offer cards */
.limited-offer-card .card-body small.text-muted {
    color: rgba(255,255,255,0.92);
    opacity: 1;
}
    .limited-offer-card .card-body .item-count {
    /* Fallback solid color, then use semi-transparent accent via rgb variable */
    background: rgba(30,136,229,0.95);
    background: rgba(var(--accent-blue-rgb), 0.95);
    color: #ffffff;
    font-weight: 700;
    margin: 0 6px;
    padding: 3px 10px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(2,6,23,0.35);
    font-size: 0.95rem;
    display: inline-block;
}

/* Theme-aware tweaks while keeping the accent background */
html[data-theme='dark'] .limited-offer-card .card-body small.text-muted {
    color: rgba(255,255,255,0.95) !important;
}
html[data-theme='dark'] .limited-offer-card .card-body .item-count {
    background: var(--accent-blue);
    color: #ffffff;
    border: 1px solid rgba(255,255,255,0.06);
}

html[data-theme='light'] .limited-offer-card .card-body small.text-muted {
    color: rgba(30,30,30,0.88) !important;
}
html[data-theme='light'] .limited-offer-card .card-body .item-count {
    background: var(--accent-blue);
    color: #ffffff;
    border: 1px solid rgba(0,0,0,0.06);
}

.limited-offer-card .text-info {
    font-size: 1.1rem;
    font-weight: 700;
    text-shadow: 0 2px 6px rgba(0,0,0,0.4);
    background: linear-gradient(135deg, #64B5F6, #42A5F5);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.limited-offer-card .time-progress {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 6px;
    background: rgba(255,255,255,0.2);
    z-index: 2;
    overflow: hidden;
}

.limited-offer-card .time-progress::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: shimmer 2s linear infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.limited-offer-card .time-progress .bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #FF6B6B, #FFC107, #42A5F5);
    background-size: 200% 100%;
    animation: gradientFlow 3s ease infinite;
    transition: width 0.5s ease;
    box-shadow: 0 0 10px rgba(66,165,245,0.6);
    position: relative;
    z-index: 1;
}

@keyframes gradientFlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .limited-offers .lo-title {
        font-size: 1.1rem;
    }
    
    .limited-offer-card {
        min-height: 200px;
    }
    
    .limited-offer-card .card-body {
        padding: 18px !important;
    }
}

/* Light theme refinements */
html[data-theme='light'] .limited-offers {
    background: linear-gradient(145deg, #FFFFFF, #F5F9FF);
    border-image: linear-gradient(135deg, rgba(25,118,210,0.3), rgba(66,165,245,0.2)) 1;
    box-shadow: 0 8px 32px rgba(25,118,210,0.15), 0 0 0 1px rgba(25,118,210,0.1);
}

html[data-theme='light'] .limited-offers .lo-header {
    background: linear-gradient(135deg, rgba(25,118,210,0.12), rgba(25,118,210,0.06));
    border-bottom-color: rgba(25,118,210,0.15);
}

html[data-theme='light'] .limited-offers .lo-title {
    color: var(--light-text);
    text-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

html[data-theme='light'] .limited-offer-card {
    border-color: rgba(25,118,210,0.25) !important;
    box-shadow: 0 4px 20px rgba(25,118,210,0.12), 0 0 0 1px rgba(25,118,210,0.08);
}

html[data-theme='light'] .limited-offer-card:hover {
    border-color: rgba(25,118,210,0.5) !important;
    box-shadow: 0 12px 40px rgba(25,118,210,0.25), 0 0 0 1px rgba(25,118,210,0.3);
}

html[data-theme='light'] .limited-offer-card .overlay-top {
    background: linear-gradient(180deg, rgba(255,255,255,0.2), rgba(255,255,255,0.4));
}

/* Remove underlines for any link text inside the clickable card wrapper */
.limited-offer-card, .limited-offer-card * {
    text-decoration: none !important;
}

/* Categories Carousel Styling */

.categories-carousel-container {
    position: relative;
    padding: 0 80px;
    margin-top: 30px;
    overflow: hidden;
}

.categories-carousel-track {
    display: flex;
    gap: 30px;
    transition: transform 0.5s cubic-bezier(0.4,0,0.2,1);
    will-change: transform;
}

.category-carousel-item {
    min-width: 0;
    flex: 0 0 calc(100%/3 - 20px);
    transition: opacity 0.3s, box-shadow 0.3s;
}

@media (max-width: 1200px) {
    .category-carousel-item {
        flex: 0 0 calc(50% - 15px);
    }
}
@media (max-width: 768px) {
    .categories-carousel-container {
        padding: 0 60px;
    }
    .category-carousel-item {
        flex: 0 0 100%;
    }
}

.category-carousel-item .card {
    height: 100%;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.category-carousel-item .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(30,136,229,0.3);
}

.category-carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(30, 136, 229, 0.15);
    border: 2px solid var(--accent-blue);
    color: var(--accent-blue);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    font-size: 1.2rem;
    backdrop-filter: blur(8px);
}

.category-carousel-nav:hover {
    background: var(--accent-blue);
    color: white;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 5px 15px rgba(30, 136, 229, 0.3);
}

.category-carousel-prev {
    left: 10px;
}

.category-carousel-next {
    right: 10px;
}

/* Light theme */
html[data-theme='light'] .category-carousel-nav {
    background: rgba(25, 118, 210, 0.1);
    border-color: var(--light-accent);
    color: var(--light-accent);
}

html[data-theme='light'] .category-carousel-nav:hover {
    background: var(--light-accent);
    color: white;
}

/* Responsive */
@media (max-width: 1200px) {
    .categories-carousel-track {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .categories-carousel-container {
        padding: 0 60px;
    }
    
    .categories-carousel-track {
        grid-template-columns: 1fr;
    }
    
    .category-carousel-nav {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
    
    .category-carousel-prev {
        left: 5px;
    }
    
    .category-carousel-next {
        right: 5px;
    }
}

/* Hero refresh: make headlines readable on all themes */
.hero-section { position: relative; aspect-ratio: 16 / 6; overflow: hidden; border-radius: 16px; }
.hero-slide { position: absolute; inset: 0; opacity: 0; visibility: hidden; transition: opacity 0.8s ease, visibility 0.8s ease, transform 0.8s ease; transform: scale(1.01); }
.hero-slide.active { opacity: 1; visibility: visible; transform: scale(1); }
.hero-slide::after { content: ''; position: absolute; inset: 0; background: linear-gradient(120deg, rgba(5,10,25,0.65), rgba(5,10,25,0.25) 45%, rgba(0,0,0,0.4)); mix-blend-mode: multiply; z-index: 1; }
.hero-image { width: 100%; height: 100%; object-fit: cover; filter: saturate(1.05); }
.hero-content { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: flex-start; justify-content: center; gap: 14px; padding: 0 7vw; z-index: 2; color: #fdfdfd; text-shadow: 0 10px 30px rgba(0,0,0,0.7); max-width: 820px; }
.hero-title { font-size: clamp(2.4rem, 4vw + 1rem, 3.8rem); font-weight: 800; letter-spacing: 0.02em; color: #fdfdfd !important; }
.hero-subtitle { font-size: clamp(1.05rem, 1.5vw, 1.2rem); line-height: 1.7; max-width: 720px; color: rgba(255,255,255,0.92) !important; }
.hero-nav { z-index: 3; background: rgba(10,20,35,0.45); border: 2px solid rgba(255,255,255,0.25); color: #fff; }
.hero-nav:hover { background: rgba(25,118,210,0.8); border-color: rgba(255,255,255,0.6); }
.hero-content { color: #fdfdfd !important; }
.hero-subtitle { color: rgba(255,255,255,0.92) !important; }
@media (max-width: 768px) {
    .hero-section { aspect-ratio: 16 / 9; border-radius: 10px; }
    .hero-content { padding: 0 22px; align-items: flex-start; }
}
</style>
{% endblock %}

{% block content %}
<!-- Hero Section with Carousel -->
<div class="hero-section">
    <div class="hero-slide active">
        <img src="{% static 'images/image1.png' %}" alt="Aquatic scape" class="hero-image">
        <div class="hero-content">
            <h1 class="hero-title">WELCOME TO FISHY FRIEND AQUA</h1>
            <p class="hero-subtitle">Discover your favorite fishy friends from our healthy and handpicked collections.</p>
        </div>
    </div>

    <div class="hero-slide">
        <img src="{% static 'images/image2.jpg' %}" alt="Aquatic scape" class="hero-image">
        <div class="hero-content">
            <h1 class="hero-title">EXPERT KNOWLEDGE, YOUR SUCCESS</h1>
            <p class="hero-subtitle">Master fishkeeping with our comprehensive blogs and expert tips for a thriving ecosystem.</p>
        </div>
    </div>

    <div class="hero-slide">
        <img src="{% static 'images/image4.png' %}" alt="Aquatic scape" class="hero-image">
        <div class="hero-content">
            <h1 class="hero-title">CREATE UNDERWATER MASTERPICES</h1>
            <p class="hero-subtitle">Transform your tank into a living aquascape with stunning plants, hardscape, and vibrant fish.</p>
        </div>
    </div>

    <div class="hero-slide">
        <img src="{% static 'images/image5.jpg' %}" alt="Aquatic scape" class="hero-image">
        <div class="hero-content">
            <h1 class="hero-title">DIRECT FROM FARM, STRAIGHT TO YOUR HOME</h1>
            <p class="hero-subtitle">Raised at our own farm or sourced directly from trusted breeders for superior health, better quality, and reasonable prices.</p>
        </div>
    </div>

    <div class="hero-slide">
        <img src="{% static 'images/image6.JPG' %}" alt="Aquatic scape" class="hero-image">
        <div class="hero-content">
            <h1 class="hero-title">EXOTIC COLLECTIONS YOU WON’T FIND ANYWHERE ELSE.</h1>
            <p class="hero-subtitle">From rare color morphs to selectively bred exotics, our collection is raised at our own farm for unmatched quality and reliability.</p>
        </div>
    </div>

    <div class="hero-slide">
        <img src="{% static 'images/image7.JPG' %}" alt="Aquatic scape" class="hero-image">
        <div class="hero-content">
            <h1 class="hero-title">STARTING A BREEDING PROJECT? WE’VE GOT YOU.</h1>
            <p class="hero-subtitle">New to breeding? We provide the right fish, guidance, and support to help you succeed from the start.</p>
        </div>
    </div>

    <div class="hero-slide">
        <img src="{% static 'images/image8.jpg' %}" alt="Aquatic scape" class="hero-image">
        <div class="hero-content">
            <h1 class="hero-title">BATTLING ALGAE? OUR CLEANUP CREW HAS YOUR BACK.</h1>
            <p class="hero-subtitle">From algae-eating fish to snails and shrimp, our cleanup crew works round the clock to keep algae under control.</p>
        </div>
    </div>

    <!-- Navigation Arrows -->
    <button class="hero-nav hero-nav-prev" id="heroPrev" aria-label="Previous slide">
        <i class="fas fa-chevron-left"></i>
    </button>
    <button class="hero-nav hero-nav-next" id="heroNext" aria-label="Next slide">
        <i class="fas fa-chevron-right"></i>
    </button>
</div>

<!-- About Section -->
{# Limited Offers section (only limited_offers) #}
{% if limited_offers %}
<section class="section">
    <div class="container-fluid">
        <h2 class="section-heading" style="margin-top:6px; margin-bottom:8px;">Limited Offers</h2>
    </div>
</section>
<section class="limited-offers-banner">
    <div class="container-fluid">
        <div class="offer-banner-carousel">
            {% for offer in limited_offers %}
                <a href="{% if offer.is_combo and offer.combo_id %}{% url 'combo_detail' offer.combo_id %}{% elif offer.fish %}{% url 'fish_detail' offer.fish.id %}{% else %}{% url 'fish_list' %}{% endif %}"
                   class="offer-banner-item {% if forloop.first %}active{% endif %}"
                   {% if offer.start_time %}data-start-time="{{ offer.start_time|date:'c' }}"{% endif %}
                   {% if offer.end_time %}data-end-time="{{ offer.end_time|date:'c' }}"{% endif %}>
                    {% if offer.is_combo %}
                        <div class="offer-banner-bg combo-banner-bg">
                            <div class="combo-collage {% if offer.images %}split-layout{% endif %}" {% if offer.images %}style="--cols: {{ offer.images|length }};"{% endif %} aria-hidden="true">
                                {% for img in offer.images %}
                                    <div class="collage-cell" style="background-image: url('{{ img }}')"></div>
                                {% endfor %}
                                {% if not offer.images %}
                                    {% if offer.fish and offer.fish.image %}
                                        <div class="collage-cell" style="background-image: url('{{ offer.fish.image.url }}')"></div>
                                    {% else %}
                                        <div class="collage-cell collage-empty"></div>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        <div class="offer-banner-overlay"></div>
                    {% elif offer.fish and offer.fish.image %}
                        <div class="offer-banner-bg" style="background-image: url('{{ offer.fish.image.url }}');"></div>
                        <div class="offer-banner-overlay"></div>
                    {% elif offer.image %}
                        <div class="offer-banner-bg" style="background-image: url('{{ offer.image }}');"></div>
                        <div class="offer-banner-overlay"></div>
                    {% elif offer.bg_color %}
                        <div class="offer-banner-bg" style="background: {{ offer.bg_color }};"></div>
                        <div class="offer-banner-overlay"></div>
                    {% else %}
                        <div class="offer-banner-bg offer-banner-solid"></div>
                        <div class="offer-banner-overlay"></div>
                    {% endif %}

                    <div class="offer-banner-content{% if offer.is_combo %} combo-content{% endif %}">
                        <div class="offer-banner-top">
                            <div>
                                <div class="d-flex align-items-center mb-3">
                                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="me-2 text-warning" aria-hidden="true" focusable="false"><path d="M13 2L3 14h9l-1 8L21 10h-9l1-8z" fill="currentColor"/></svg>
                                    <span style="font-size: 1rem; font-weight: 600; opacity: 0.9;">LIMITED TIME OFFER</span>
                                </div>
                                <h2 class="offer-banner-title">{{ offer.title }}</h2>
                                <div class="offer-banner-discount">{{ offer.discount_text }}</div>
                                {# Description intentionally hidden for accessory banners #}
                                {% if offer.fish %}
                                    <p class="offer-banner-fish-info" style="font-size: 1rem; margin-top: 12px; opacity: 0.9;">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="me-2" aria-hidden="true" focusable="false"><path d="M22 12c0 0-2-2-6-2s-6 2-8 2-4-1-6-3c2-2 5-4 9-4s7 2 11 6z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M18 6c.5 1 2 2 3 2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>{{ offer.fish.name }} - {{ offer.fish.breed.name }}
                                    </p>
                                {% endif %}
                            </div>
                        </div>

                        <div class="offer-banner-footer">
                            <!-- countdown removed -->
                        </div>

                        <div class="offer-progress-container">
                            <div class="offer-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </a>
            {% endfor %}

            <button class="offer-carousel-nav offer-carousel-prev" id="offerCarouselPrev" aria-label="Previous offer" title="Previous offer" tabindex="0" aria-controls="offerCarousel">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="offer-carousel-nav offer-carousel-next" id="offerCarouselNext" aria-label="Next offer" title="Next offer" tabindex="0" aria-controls="offerCarousel">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M9 6L15 12L9 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
    </div>
</section>
{% endif %}

{# Accessories section (separate from limited offers) #}
{% if accessory_banners %}
<section class="section">
    <div class="container-fluid">
        <h2 class="section-heading" style="margin-top:6px; margin-bottom:4px;">Featured accessory</h2>
    </div>
</section>
<section class="limited-offers-banner" style="margin-top:6px;">
    <div class="container-fluid">
        <div class="offer-banner-carousel">
            {% for offer in accessory_banners %}
                <a href="{% url 'accessory_detail' offer.id %}" class="offer-banner-item {% if forloop.first %}active{% endif %}">
                    {% if offer.image %}
                        <div class="offer-banner-bg" style="background-image: url('{{ offer.image }}');"></div>
                        <div class="offer-banner-overlay"></div>
                    {% else %}
                        <div class="offer-banner-bg offer-banner-solid"></div>
                        <div class="offer-banner-overlay"></div>
                    {% endif %}

                    <div class="offer-banner-content">
                        <div class="offer-banner-top">
                            <div>
                                <div class="d-flex align-items-center mb-3">
                                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="me-2 text-warning" aria-hidden="true" focusable="false"><path d="M13 2L3 14h9l-1 8L21 10h-9l1-8z" fill="currentColor"/></svg>
                                    <span style="font-size: 1rem; font-weight: 600; opacity: 0.9;">FEATURED ACCESSORY</span>
                                </div>
                                <h2 class="offer-banner-title">{{ offer.title }}</h2>
                                {# Description intentionally hidden for accessory banners #}
                            </div>
                        </div>

                        <div class="offer-banner-footer">
                            <!-- accessory banners are static — no countdown or progress -->
                        </div>
                    </div>
                </a>
            {% endfor %}

            <button class="offer-carousel-nav offer-carousel-prev" id="accessoryCarouselPrev" aria-label="Previous accessory" title="Previous accessory" tabindex="0" aria-controls="accessoryCarousel">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="offer-carousel-nav offer-carousel-next" id="accessoryCarouselNext" aria-label="Next accessory" title="Next accessory" tabindex="0" aria-controls="accessoryCarousel">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M9 6L15 12L9 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
    </div>
</section>
{% endif %}

{# Combo Banners: render wide banners for combos marked as banners, using limited-offer banner layout #}
{% if combo_banners or combo_deals %}
<section class="section" style="margin-bottom: 0; padding-bottom: 0;">
    <div class="container-fluid">
        <div class="combo-heading-wrapper {% if combo_banners %}has-banners{% else %}cards-only{% endif %}">
            <h2 class="section-heading" style="margin-top: 0; margin-bottom: 0;">Combo Deals</h2>
        </div>
    </div>
</section>

{% endif %}

{% if hero_items %}
<!-- Combo hero: dedicated section to avoid overlapping the main homepage hero -->
<section class="section combo-hero-wrapper" aria-label="Combo hero">
    <div class="container-fluid">
        <div class="combo-hero-banner">
            <style>
                .combo-hero-wrapper { margin-top: 0; }
                .combo-hero-banner { position: relative; overflow: hidden; border-radius: 16px; box-shadow: 0 16px 42px rgba(0,0,0,0.25); }
                .cb-track { position: relative; min-height: 380px; }
                .cb-slide { position:absolute; inset:0; background-size:cover; background-position:center; opacity:0; transition: opacity 500ms ease; display:flex; align-items:flex-start; text-decoration:none; color:inherit; }
                .cb-slide.active { opacity:1; z-index:2; }
                .cb-overlay { position:absolute; inset:0; background: linear-gradient(120deg, rgba(6,14,30,0.65), rgba(6,14,30,0.25)); }
                .cb-content { position:relative; z-index:3; padding: 52px 32px 32px; max-width: 640px; color:#fff; text-shadow:0 10px 24px rgba(0,0,0,0.35); }
                .cb-badge { display:inline-block; padding:6px 12px; border-radius:999px; background: rgba(255,255,255,0.9); color:#0b2540; font-weight:700; }
                .cb-title { font-size: clamp(1.8rem, 4vw, 3rem); font-weight:800; margin:12px 0 8px; }
                .cb-desc { opacity:0.95; margin-bottom:12px; font-size:1.05rem; }
                .cb-items { opacity:0.9; margin:0 0 18px; font-size:0.95rem; font-weight:600; }
                .cb-items span { font-weight:500; opacity:0.95; }
                .cb-nav { position:absolute; top:50%; transform:translateY(-50%); z-index:4; background:rgba(0,0,0,0.4); border:none; color:#fff; width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; backdrop-filter: blur(6px); }
                .cb-prev { left:18px; }
                .cb-next { right:18px; }
                .cb-nav:hover { background:rgba(0,0,0,0.6); }
                @media (max-width: 767px) {
                    .combo-hero-wrapper { margin-top: 0; }
                    .cb-content { padding:32px 20px; max-width:100%; }
                    .cb-title { font-size:1.6rem; }
                    .cb-desc { font-size:0.98rem; }
                    .cb-track { min-height: 300px; }
                }
            </style>

            <div class="cb-track" data-interval="6500">
                {% for b in hero_items %}
                <a class="cb-slide {% if forloop.first %}active{% endif %}" href="{% url 'combo_detail' b.combo_id %}" style="background-image:url('{{ b.image|default:'' }}');">
                    <div class="cb-overlay"></div>
                    <div class="container">
                        <div class="cb-content">
                            {% if b.discount_text %}<span class="cb-badge">{{ b.discount_text }}</span>{% endif %}
                            <h2 class="cb-title">{{ b.title }}</h2>
                            {% if b.description %}<p class="cb-desc">{{ b.description|truncatechars:180 }}</p>{% endif %}
                            {% if b.item_names %}
                            <p class="cb-items">Includes: <span>{{ b.item_names|join:", " }}</span></p>
                            {% endif %}
                        </div>
                    </div>
                </a>
                {% endfor %}

                {% if hero_items|length > 1 %}
                <button class="cb-nav cb-prev" aria-label="Previous">&#10094;</button>
                <button class="cb-nav cb-next" aria-label="Next">&#10095;</button>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        (function(){
            try{
                const track = document.querySelector('.cb-track');
                const slides = track ? track.querySelectorAll('.cb-slide') : [];
                if(!track || slides.length === 0) return;
                let idx = 0; const interval = (track.dataset.interval|0) || 6500;
                const show = (i) => { slides.forEach((s,j)=>s.classList.toggle('active', j===i)); };
                const next = ()=>{ idx = (idx+1)%slides.length; show(idx); };
                const prev = ()=>{ idx = (idx-1+slides.length)%slides.length; show(idx); };
                let timer = slides.length>1 ? setInterval(next, interval) : null;
                const stop = ()=>{ if(timer){ clearInterval(timer); timer=null; }};
                const start = ()=>{ if(!timer && slides.length>1){ timer=setInterval(next, interval);} };
                const prevBtn = track.querySelector('.cb-prev');
                const nextBtn = track.querySelector('.cb-next');
                prevBtn && prevBtn.addEventListener('click', ()=>{ stop(); prev(); start(); });
                nextBtn && nextBtn.addEventListener('click', ()=>{ stop(); next(); start(); });
                track.addEventListener('mouseenter', stop);
                track.addEventListener('mouseleave', start);
            }catch(e){ console && console.warn && console.warn('combo hero init failed', e); }
        })();
    </script>
</section>
{% endif %}

{# Combo Deals section: render separately when `combo_deals` exists #}
{% if combo_deals %}
<section class="section">
    <div class="container-fluid">
        <div class="combos-carousel-container categories-carousel-container">
            <div class="combos-carousel-track categories-carousel-track">
                {% for combo in combo_deals %}
                <div class="category-carousel-item combo-carousel-item">
                    <a href="{% if combo.is_combo and combo.combo_id %}{% url 'combo_detail' combo.combo_id %}{% else %}{% url 'combos' %}{% endif %}" class="card category-card limited-offer-card">
                        {% if combo.images and combo.images.0 %}
                        <div style="height:180px; background-image: url('{{ combo.images.0 }}'); background-size: cover; background-position: center; border-top-left-radius: 12px; border-top-right-radius: 12px;"></div>
                        {% elif combo.fish and combo.fish.image %}
                        <div style="height:180px; background-image: url('{{ combo.fish.image.url }}'); background-size: cover; background-position: center; border-top-left-radius: 12px; border-top-right-radius: 12px;"></div>
                        {% else %}
                        <div style="height:180px; background: linear-gradient(135deg,#0f1724,#071022); border-top-left-radius: 12px; border-top-right-radius: 12px;"></div>
                        {% endif %}
                        <div class="card-body">
                            <h3 class="card-title">{{ combo.title }}</h3>
                            <div class="text-info mb-2">{{ combo.discount_text }}</div>
                            <p class="mb-2" style="opacity:0.9;">{{ combo.description|truncatechars:120 }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">Includes {% with combo.images|length as count %}{% if count > 0 %}<span class="item-count">{{ count }}</span>{% elif combo.fish %}<span class="item-count">1</span>{% else %}<span class="item-count">0</span>{% endif %}{% endwith %} items</small>
                                <span class="btn btn-sm btn-outline-light">View</span>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>

            <!-- Navigation Buttons for combos -->
            <button class="category-carousel-nav category-carousel-prev" id="comboPrev" aria-label="Previous combos">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="category-carousel-nav category-carousel-next" id="comboNext" aria-label="Next combos">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M9 6L15 12L9 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
    </div>
</section>
{% endif %}
    

{# Removed categories carousel from home page #}

<!-- Featured Fishes Section -->
{% if fishes %}
<section class="section">
    <div class="container-fluid">
        <h2 class="section-heading">Featured Fishes</h2>

        <style>
        /* Featured carousel: horizontal track + cards */
        .featured-carousel-container { position: relative; overflow: hidden; padding: 10px 0; }
        .featured-carousel-track { display: flex; gap: 24px; transition: transform 0.5s cubic-bezier(0.4,0,0.2,1); will-change: transform; align-items: stretch; }
        .featured-item { flex: 0 0 auto; width: calc(25% - 18px); }
        .featured-item .card { height: 100%; }

        @media (max-width: 1200px) { .featured-item { width: calc(33.333% - 16px); } }
        @media (max-width: 768px)  { .featured-item { width: calc(50% - 12px); } }
        @media (max-width: 576px)  { .featured-item { width: calc(100% - 8px); } }

        .featured-carousel-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(30, 136, 229, 0.15); border: 2px solid var(--accent-blue); color: var(--accent-blue); width: 44px; height: 44px; border-radius: 50%; display:flex; align-items:center; justify-content:center; z-index: 10; cursor:pointer; transition: all 0.3s ease; }
        .featured-carousel-nav:hover { transform: translateY(-50%) scale(1.1); background: var(--accent-blue); color: white; box-shadow: 0 4px 12px rgba(30, 136, 229, 0.3); }
        .featured-prev { left: 8px; }
        .featured-next { right: 8px; }
        html[data-theme='light'] .featured-carousel-nav { background: rgba(25, 118, 210, 0.1); border-color: var(--light-accent); color: var(--light-accent); }
        html[data-theme='light'] .featured-carousel-nav:hover { background: var(--light-accent); color: white; box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3); }
        </style>

        <div class="featured-carousel-container">
            <div class="featured-carousel-track">
                {% for fish in fishes %}
                <div class="featured-item">
                    <div class="card">
                        {% if fish.image %}
                        <img src="{{ fish.image.url }}" class="card-img-top" alt="{{ fish.name }}">
                        {% else %}
                        <div class="card-img-top" style="height: 250px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-light-blue)); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-fish fa-5x" style="opacity: 0.3;"></i>
                        </div>
                        {% endif %}
                        <div class="card-body">
                            <span class="category-badge">{{ fish.category.name }}</span>
                            <h5 class="card-title mt-2">{{ fish.name }}</h5>
                            <p class="card-text">{{ fish.description|truncatewords:15 }}</p>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <span class="price-badge">{{ fish.price|rupees }}</span>
                                {% if user.is_authenticated and user.role == 'customer' %}
                                    <a href="{% url 'fish_detail' fish.id %}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                {% elif not user.is_authenticated %}
                                    <a href="{% url 'login' %}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Nav -->
            <button class="featured-carousel-nav featured-prev" id="featuredPrev" aria-label="Previous featured">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="featured-carousel-nav featured-next" id="featuredNext" aria-label="Next featured">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</section>
{% endif %}

<!-- Reviews Section -->
{% if reviews %}
<section class="section review-section" style="padding: 80px 0;">
    <div class="container-fluid">
        <h2 class="section-heading mb-5">What Customers Say</h2>
        <div class="review-carousel-container" style="max-width: 1000px; margin: 0 auto; position: relative;">
            <div id="reviewCarouselTrack" style="min-height: 280px; padding: 40px 80px;">
                {% for r in reviews %}
                <div class="review-slide" style="display:none;">
                    <div class="d-flex flex-column align-items-center text-center">
                        <!-- Star Rating -->
                        <div class="mb-4" style="font-size: 1.5rem;">
                            {% for ch in '12345' %}
                                {% if forloop.counter <= r.rating %}
                                    <i class="fas fa-star" style="color:#FFC107;"></i>
                                {% else %}
                                    <i class="far fa-star" style="color:#FFE082;"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        
                        <!-- Review Comment -->
                        <div class="mb-4" style="position: relative;">
                            <i class="fas fa-quote-left" style="position: absolute; left: -30px; top: -10px; font-size: 2rem; color: var(--accent-blue); opacity: 0.3;"></i>
                            <p class="text-white" style="max-width: 700px; font-size: 1.1rem; line-height: 1.9; font-weight: 300; padding: 0 20px; word-break: break-word; white-space: pre-line;">
                                {{ r.comment|default:'Great experience! Highly recommended.' }}
                            </p>
                            <i class="fas fa-quote-right" style="position: absolute; right: -30px; bottom: -10px; font-size: 2rem; color: var(--accent-blue); opacity: 0.3;"></i>
                        </div>

                        {% if r.image %}
                        <div class="mb-3" style="max-width: 520px; width: 100%;">
                            <img src="{{ r.image.url }}" alt="Customer review photo" style="width: 100%; height: auto; border-radius: 12px; border: 1px solid rgba(100,150,255,0.3); box-shadow: 0 8px 24px rgba(0,0,0,0.25); object-fit: cover;">
                        </div>
                        {% endif %}
                        
                        <!-- User Info -->
                        <div class="mt-3">
                            <div class="mb-2">
                                <span class="text-white" style="font-size: 1rem; font-weight: 500;">
                                    <i class="fas fa-user-circle me-2" style="color: var(--accent-blue);"></i>{{ r.user.username }}
                                </span>
                            </div>
                            <div class="mt-2">
                                <small style="font-size: 0.85rem; color: rgba(200, 200, 200, 0.95);">
                                    <i class="far fa-calendar-alt me-1"></i>{{ r.created_at|date:"M d, Y" }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Navigation Arrows -->
            <button id="reviewPrev" class="review-nav-btn review-nav-prev" aria-label="Previous review">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="reviewNext" class="review-nav-btn review-nav-next" aria-label="Next review">
                <i class="fas fa-chevron-right"></i>
            </button>
            
            <!-- Indicator Dots -->

        </div>
    </div>
</section>

<style>
.review-section {
    background: var(--darker-bg);
}

html[data-theme='light'] .review-section {
    background: var(--light-surface);
}

.review-carousel-container {
    position: relative;
}

.review-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(30, 136, 229, 0.15);
    border: 2px solid var(--accent-blue);
    color: var(--accent-blue);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    font-size: 1.2rem;
}

.review-nav-btn:hover {
    background: var(--accent-blue);
    color: white;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 5px 15px rgba(30, 136, 229, 0.3);
}

.review-nav-prev {
    left: 10px;
}

.review-nav-next {
    right: 10px;
}

.review-indicators {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 30px;
}

.review-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
}

.review-dot:hover {
    background: rgba(255, 255, 255, 0.5);
    transform: scale(1.2);
}

.review-dot.active {
    background: var(--accent-blue);
    width: 30px;
    border-radius: 5px;
}

html[data-theme='light'] .review-nav-btn {
    background: rgba(25, 118, 210, 0.1);
    border-color: var(--light-accent);
    color: var(--light-accent);
}

html[data-theme='light'] .review-nav-btn:hover {
    background: var(--light-accent);
    color: white;
}

html[data-theme='light'] .review-dot {
    background: rgba(0, 0, 0, 0.2);
}

html[data-theme='light'] .review-dot:hover {
    background: rgba(0, 0, 0, 0.4);
}

html[data-theme='light'] .review-dot.active {
    background: var(--light-accent);
}

@media (max-width: 768px) {
    #reviewCarouselTrack {
        padding: 40px 60px !important;
    }
    
    .review-nav-btn {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
    
    .review-nav-prev {
        left: 5px;
    }
    
    .review-nav-next {
        right: 5px;
    }
}
</style>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
// Hero Carousel
document.addEventListener('DOMContentLoaded', function(){
    try {
        console.debug('home.js DOMContentLoaded');
    const heroSlides = document.querySelectorAll('.hero-slide');
    const heroDots = document.querySelectorAll('.hero-dot');
    const heroPrevBtn = document.getElementById('heroPrev');
    const heroNextBtn = document.getElementById('heroNext');
    
    let heroIdx = 0;
    let heroAutoPlayInterval;
    
    function showHeroSlide(i){
        heroSlides.forEach((slide, j) => {
            if(j === i) {
                slide.classList.add('active');
            } else {
                slide.classList.remove('active');
            }
        });
        
        heroDots.forEach((dot, j) => {
            if(j === i) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    }
    
    function nextHeroSlide(){
        heroIdx = (heroIdx + 1) % heroSlides.length;
        showHeroSlide(heroIdx);
    }
    
    function prevHeroSlide(){
        heroIdx = (heroIdx - 1 + heroSlides.length) % heroSlides.length;
        showHeroSlide(heroIdx);
    }
    
    function startHeroAutoPlay(){
        stopHeroAutoPlay();
        heroAutoPlayInterval = setInterval(nextHeroSlide, 5000);
    }
    
    function stopHeroAutoPlay(){
        if(heroAutoPlayInterval){
            clearInterval(heroAutoPlayInterval);
        }
    }
    
    // Initialize hero carousel
    if(heroSlides.length > 0){
        showHeroSlide(heroIdx);
        startHeroAutoPlay();
        
        // Navigation buttons
        heroNextBtn?.addEventListener('click', function(){
            nextHeroSlide();
            stopHeroAutoPlay();
            startHeroAutoPlay();
        });
        
        heroPrevBtn?.addEventListener('click', function(){
            prevHeroSlide();
            stopHeroAutoPlay();
            startHeroAutoPlay();
        });
        
        // Dot indicators
        heroDots.forEach((dot, i) => {
            dot.addEventListener('click', function(){
                heroIdx = i;
                showHeroSlide(heroIdx);
                stopHeroAutoPlay();
                startHeroAutoPlay();
            });
        });
        
        // Pause on hover
        const heroSection = document.querySelector('.hero-section');
        if(heroSection){
            heroSection.addEventListener('mouseenter', stopHeroAutoPlay);
            heroSection.addEventListener('mouseleave', startHeroAutoPlay);
        }
    }
    
    // Enhanced review carousel with indicators
    const track = document.querySelector('#reviewCarouselTrack');
    if(track) {

    const items = track.querySelectorAll('.review-slide');
    const dots = document.querySelectorAll('.review-dot');

    const prevBtn = document.getElementById('reviewPrev');
    const nextBtn = document.getElementById('reviewNext');
    
    let idx = 0;
    let reviewAutoPlayInterval;
    
    function show(i){
        items.forEach((el, j) => {
            el.style.display = j === i ? 'block' : 'none';
        });
        
        dots.forEach((dot, j) => {
            if(j === i) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    }
    
    function next(){
        idx = (idx + 1) % items.length;
        show(idx);
    }
    
    function prev(){
        idx = (idx - 1 + items.length) % items.length;
        show(idx);
    }
    
    function startAutoPlay(){
        stopAutoPlay();
        reviewAutoPlayInterval = setInterval(next, 5000);
    }
    
    function stopAutoPlay(){
        if(reviewAutoPlayInterval){
            clearInterval(reviewAutoPlayInterval);
        }
    }
    
    // Initialize
    show(idx);
    startAutoPlay();
    
    // Navigation buttons
    nextBtn?.addEventListener('click', function(){
        next();
        stopAutoPlay();
        startAutoPlay();
    });
    
    prevBtn?.addEventListener('click', function(){
        prev();
        stopAutoPlay();
        startAutoPlay();
    });
    
    // Dot indicators (if any)
    if(dots && dots.length){
        dots.forEach((dot, i) => {
            dot.addEventListener('click', function(){
                idx = i;
                show(idx);
                stopAutoPlay();
                startAutoPlay();
            });
        });
    }
    
    // Pause on hover
    track.addEventListener('mouseenter', stopAutoPlay);
    track.addEventListener('mouseleave', startAutoPlay);

    } // end if(track)
    
    // Offer Banner Carousel (initialize every .offer-banner-carousel on the page)
    (function(){
        const carousels = Array.from(document.querySelectorAll('.offer-banner-carousel'));
        if(!carousels.length) return;

        carousels.forEach((offerCarousel) => {
            const banners = Array.from(offerCarousel.querySelectorAll('.offer-banner-item'));
            const prevBtn = offerCarousel.querySelector('.offer-carousel-prev');
            const nextBtn = offerCarousel.querySelector('.offer-carousel-next');
            const dots = Array.from(offerCarousel.querySelectorAll('.offer-carousel-dot'));

            if(banners.length === 0) return;

            function visibleIndices(){
                const arr = [];
                banners.forEach((b, i) => { if(!b.classList.contains('offer-hidden')) arr.push(i); });
                return arr;
            }

            function firstVisibleIndex(){
                const vis = visibleIndices();
                return vis.length ? vis[0] : -1;
            }

            let idx = banners.findIndex(b => b.classList.contains('active'));
            if(idx === -1) idx = firstVisibleIndex();
            if(idx === -1) {
                // No visible banners at all; hide the carousel wrapper
                offerCarousel.style.display = 'none';
                return;
            }
            let autoInterval = null;

            function show(i){
                const vis = visibleIndices();
                if(!vis.length){ offerCarousel.style.display = 'none'; return; }
                offerCarousel.style.display = '';
                // Normalize i to a visible index
                if(!vis.includes(i)){
                    // Find next visible after i, or wrap to first
                    const after = vis.find(x => x > i);
                    i = (after !== undefined) ? after : vis[0];
                }
                idx = i;
                banners.forEach((b, j) => b.classList.toggle('active', j === idx));
                dots.forEach((d, j) => d.classList.toggle('active', j === idx));
            }

            function next(){
                const vis = visibleIndices();
                if(vis.length <= 1) return;
                const pos = vis.indexOf(idx);
                const nextPos = (pos + 1) % vis.length;
                show(vis[nextPos]);
            }
            function prev(){
                const vis = visibleIndices();
                if(vis.length <= 1) return;
                const pos = vis.indexOf(idx);
                const prevPos = (pos - 1 + vis.length) % vis.length;
                show(vis[prevPos]);
            }

            function startAuto(){
                stopAuto();
                if(visibleIndices().length > 1) autoInterval = setInterval(next, 5000);
            }
            function stopAuto(){ if(autoInterval){ clearInterval(autoInterval); autoInterval = null; } }

            // Defensive binding for controls
            if(nextBtn && !nextBtn.__offerBound){
                nextBtn.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); next(); stopAuto(); startAuto(); });
                nextBtn.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar'){ e.preventDefault(); nextBtn.click(); } });
                nextBtn.__offerBound = true;
            }

            if(prevBtn && !prevBtn.__offerBound){
                prevBtn.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); prev(); stopAuto(); startAuto(); });
                prevBtn.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar'){ e.preventDefault(); prevBtn.click(); } });
                prevBtn.__offerBound = true;
            }

            if(dots.length){
                dots.forEach((dot, i) => {
                    if(!dot.__offerBound){
                        dot.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); show(i); stopAuto(); startAuto(); });
                        dot.__offerBound = true;
                    }
                });
            }

            offerCarousel.addEventListener('mouseenter', stopAuto);
            offerCarousel.addEventListener('mouseleave', startAuto);

            // Initialize
            show(idx);
            startAuto();
        });
    })();
    
    // Limited Offers Banner: countdown + progress bars
    function fmt(n){ return n.toString().padStart(2,'0'); }
    function updateOfferBanners(){
        const banners = document.querySelectorAll('.offer-banner-item');
            const now = Date.now();
            banners.forEach(banner => {
                const startStr = banner.getAttribute('data-start-time');
                const endStr = banner.getAttribute('data-end-time');
                const progressBar = banner.querySelector('.offer-progress-bar');

                // If progress element is missing, nothing to update
                if (!progressBar) return;

                const hasStart = !!startStr;
                const hasEnd = !!endStr;
                const start = hasStart ? new Date(startStr).getTime() : null;
                const end = hasEnd ? new Date(endStr).getTime() : null;

                // Visibility rules
                let hide = false;
                if (hasStart && isFinite(start) && now < start) {
                    // Not started yet: set progress to 0
                    progressBar.style.width = '0%';
                } else if (hasEnd && isFinite(end)) {
                    if (now > end) {
                        // expired
                        progressBar.style.width = '100%';
                        hide = true;
                    } else {
                        // time remaining to end — do not show textual countdown
                        // leave progress update to the progress block below
                    }
                } else {
                    // No start/end: static banner
                    progressBar.style.width = '0%';
                }

                // Progress bar only meaningful when both bounds exist
                if (hasStart && hasEnd && isFinite(start) && isFinite(end) && now >= start && now <= end) {
                    const total = Math.max(1, end - start);
                    const elapsed = Math.min(Math.max(0, now - start), total);
                    const pct = Math.round((elapsed/total)*100);
                    progressBar.style.width = `${pct}%`;
            }

            // Apply hidden class rather than style.display so carousel can skip it
            if (hide) { banner.classList.add('offer-hidden'); }
            else { banner.classList.remove('offer-hidden'); }
        });
    }
    updateOfferBanners();
    setInterval(updateOfferBanners, 1000);

    // Categories Carousel: Card Switch 1 at a Time (infinite looping)
    // Scope the category carousel to the real categories container so other carousels
    // (e.g. combos) that reuse styles do not interfere.
    const categoryContainer = document.querySelector('.categories-carousel-container:not(.combos-carousel-container)');
    const categoryTrack = categoryContainer ? categoryContainer.querySelector('.categories-carousel-track') : null;
    const categoryItems = categoryTrack ? Array.from(categoryTrack.querySelectorAll('.category-carousel-item')) : [];
    const categoryPrevBtn = document.getElementById('categoryPrev');
    const categoryNextBtn = document.getElementById('categoryNext');

    function getItemsPerPage() {
        if(window.innerWidth > 1200) return 3;
        if(window.innerWidth > 768) return 2;
        return 1;
    }

    if(categoryItems.length > 0 && categoryTrack){
        let categoryStartIndex = 0; // index into realItems
        let itemsPerPage = getItemsPerPage();
        let isAnimating = false;
        let categoryAutoPlayInterval = null;

        // Real (original) items
        const realItems = categoryItems; // already an Array
        let clonesPrepended = [];
        let clonesAppended = [];
        const GAP = 30; // px gap used in CSS

        function setupClones() {
            // Remove old clones
            clonesPrepended.forEach(node => node.remove());
            clonesAppended.forEach(node => node.remove());
            clonesPrepended = [];
            clonesAppended = [];

            itemsPerPage = getItemsPerPage();
            // Clone last N items and prepend (in order)
            for(let i = realItems.length - itemsPerPage; i < realItems.length; i++){
                const idx = (i + realItems.length) % realItems.length;
                const clone = realItems[idx].cloneNode(true);
                clone.classList.add('category-clone');
                categoryTrack.insertBefore(clone, categoryTrack.firstChild);
                clonesPrepended.push(clone);
            }

            // Clone first N items and append (in order)
            for(let i = 0; i < itemsPerPage; i++){
                const clone = realItems[i].cloneNode(true);
                clone.classList.add('category-clone');
                categoryTrack.appendChild(clone);
                clonesAppended.push(clone);
            }
        }

        function getItemWidth(){
            const first = realItems[0];
            if(!first) return 0;
            return first.offsetWidth + GAP;
        }

        function updateCategoryTransform(animate = true){
            if(isAnimating) return;
            const itemWidth = getItemWidth();
            if(itemWidth === 0) return;

            const cloneCount = clonesPrepended.length;
            const offset = (categoryStartIndex + cloneCount) * itemWidth;

            if(animate) {
                isAnimating = true;
                categoryTrack.style.transition = 'transform 0.5s cubic-bezier(0.4,0,0.2,1)';
            } else {
                categoryTrack.style.transition = 'none';
            }

            categoryTrack.style.transform = `translateX(-${offset}px)`;

            if(animate){
                setTimeout(() => {
                    // If we've moved into prepended clones (index < 0)
                    if(categoryStartIndex < 0){
                        categoryTrack.style.transition = 'none';
                        categoryStartIndex = realItems.length - 1;
                        const realOffset = (categoryStartIndex + cloneCount) * itemWidth;
                        categoryTrack.style.transform = `translateX(-${realOffset}px)`;
                    }

                    // If we've moved into appended clones (index >= real length)
                    if(categoryStartIndex >= realItems.length){
                        categoryTrack.style.transition = 'none';
                        categoryStartIndex = 0;
                        const realOffset = (categoryStartIndex + cloneCount) * itemWidth;
                        categoryTrack.style.transform = `translateX(-${realOffset}px)`;
                    }

                    isAnimating = false;
                }, 500);
            }
        }

        categoryPrevBtn?.addEventListener('click', function(){
            if(isAnimating) return;
            itemsPerPage = getItemsPerPage();
            categoryStartIndex -= 1;
            updateCategoryTransform(true);
        });

        categoryNextBtn?.addEventListener('click', function(){
            if(isAnimating) return;
            itemsPerPage = getItemsPerPage();
            categoryStartIndex += 1;
            updateCategoryTransform(true);
        });

        // Auto-play
        function startAutoPlay(){
            stopAutoPlay();
            categoryAutoPlayInterval = setInterval(() => {
                if(isAnimating) return;
                categoryNextBtn?.click();
            }, 5000);
        }
        function stopAutoPlay(){
            if(categoryAutoPlayInterval) clearInterval(categoryAutoPlayInterval);
        }

        // Pause on hover
        const carouselContainer = document.querySelector('.categories-carousel-container');
        if(carouselContainer){
            carouselContainer.addEventListener('mouseenter', stopAutoPlay);
            carouselContainer.addEventListener('mouseleave', startAutoPlay);
        }

        // Initialize
        setupClones();
        // Start at first real item
        categoryStartIndex = 0;
        updateCategoryTransform(false);
        startAutoPlay();

        // Responsive: recalculate on resize
        let resizeTimer;
        window.addEventListener('resize', function(){
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                // Remove existing clones and rebuild for new itemsPerPage
                setupClones();
                // Ensure index is within bounds
                if(categoryStartIndex > realItems.length - 1){
                    categoryStartIndex = 0;
                }
                updateCategoryTransform(false);
            }, 250);
        });
    }
    } catch(err) {
        console.error('home.js uncaught error:', err);
    }
});

    // Featured fishes carousel (infinite loop with clones)
    // Combo Deals carousel (infinite loop with clones)
    (function(){
        try {
            const track = document.querySelector('.combos-carousel-track');
            const items = track ? Array.from(track.children) : [];
            const prev = document.getElementById('comboPrev');
            const next = document.getElementById('comboNext');
            if(!track || items.length === 0) return;

            const GAP = 30; // reuse same gap as categories
            let itemsPerPage = () => {
                if(window.innerWidth > 1200) return 3;
                if(window.innerWidth > 768) return 2;
                return 1;
            };

            let realItems = items;
            let clonesBefore = [];
            let clonesAfter = [];
            let index = 0; // index into realItems
            let isAnimating = false;
            let autoInterval = null;

            function getItemWidth(){
                const el = realItems[0];
                if(!el) return 0;
                return el.offsetWidth + GAP;
            }

            function buildClones(){
                clonesBefore.forEach(c=>c.remove()); clonesAfter.forEach(c=>c.remove()); clonesBefore=[]; clonesAfter=[];
                const n = itemsPerPage();
                for(let i = realItems.length - n; i < realItems.length; i++){
                    const idx = (i + realItems.length) % realItems.length;
                    const clone = realItems[idx].cloneNode(true);
                    clone.classList.add('combo-clone');
                    track.insertBefore(clone, track.firstChild);
                    clonesBefore.push(clone);
                }
                for(let i = 0; i < n; i++){
                    const clone = realItems[i].cloneNode(true);
                    clone.classList.add('combo-clone');
                    track.appendChild(clone);
                    clonesAfter.push(clone);
                }
            }

            function updateTransform(animate=true){
                if(isAnimating) return;
                const w = getItemWidth();
                if(w === 0) return;
                const offset = (index + clonesBefore.length) * w;
                if(animate){
                    isAnimating = true;
                    track.style.transition = 'transform 0.45s cubic-bezier(0.4,0,0.2,1)';
                } else {
                    track.style.transition = 'none';
                }
                track.style.transform = `translateX(-${offset}px)`;
                if(animate){
                    setTimeout(()=>{
                        if(index >= realItems.length){
                            track.style.transition = 'none';
                            index = 0;
                            const realOffset = (index + clonesBefore.length) * w;
                            track.style.transform = `translateX(-${realOffset}px)`;
                        }
                        if(index < 0){
                            track.style.transition = 'none';
                            index = realItems.length - 1;
                            const realOffset = (index + clonesBefore.length) * w;
                            track.style.transform = `translateX(-${realOffset}px)`;
                        }
                        isAnimating = false;
                    }, 480);
                }
            }

            prev?.addEventListener('click', function(){ if(isAnimating) return; index -= 1; updateTransform(true); restartAuto(); });
            next?.addEventListener('click', function(){ if(isAnimating) return; index += 1; updateTransform(true); restartAuto(); });

            function startAuto(){ stopAuto(); if(realItems.length > 1) autoInterval = setInterval(()=>{ if(!isAnimating) { index += 1; updateTransform(true); } }, 4500); }
            function stopAuto(){ if(autoInterval){ clearInterval(autoInterval); autoInterval = null; } }
            function restartAuto(){ stopAuto(); startAuto(); }

            // Pause on hover
            const container = document.querySelector('.combos-carousel-container');
            if(container){ container.addEventListener('mouseenter', stopAuto); container.addEventListener('mouseleave', startAuto); }

            // init
            buildClones();
            index = 0;
            setTimeout(()=> updateTransform(false), 50);
            startAuto();

            // responsive rebuild
            let t2;
            window.addEventListener('resize', ()=>{
                clearTimeout(t2); t2 = setTimeout(()=>{
                    buildClones();
                    updateTransform(false);
                }, 250);
            });
        } catch(e) {
            console && console.warn && console.warn('Combo carousel error', e);
        }
    })();
    (function(){
        const track = document.querySelector('.featured-carousel-track');
        const items = track ? Array.from(track.children) : [];
        const prev = document.getElementById('featuredPrev');
        const next = document.getElementById('featuredNext');
        if(!track || items.length === 0) return;

        const GAP = 24; // matches CSS gap
        let itemsPerPage = () => {
            if(window.innerWidth > 1200) return 4;
            if(window.innerWidth > 768) return 3;
            if(window.innerWidth > 576) return 2;
            return 1;
        };

        let realItems = items;
        let clonesBefore = [];
        let clonesAfter = [];
        let index = 0; // index into realItems
        let isAnimating = false;
        let autoInterval = null;

        function getItemWidth(){
            const el = realItems[0];
            if(!el) return 0;
            return el.offsetWidth + GAP;
        }

        function buildClones(){
            // remove existing clones
            clonesBefore.forEach(c=>c.remove()); clonesAfter.forEach(c=>c.remove()); clonesBefore=[]; clonesAfter=[];
            const n = itemsPerPage();
            for(let i = realItems.length - n; i < realItems.length; i++){
                const idx = (i + realItems.length) % realItems.length;
                const clone = realItems[idx].cloneNode(true);
                clone.classList.add('featured-clone');
                track.insertBefore(clone, track.firstChild);
                clonesBefore.push(clone);
            }
            for(let i = 0; i < n; i++){
                const clone = realItems[i].cloneNode(true);
                clone.classList.add('featured-clone');
                track.appendChild(clone);
                clonesAfter.push(clone);
            }
        }

        function updateTransform(animate=true){
            if(isAnimating) return;
            const w = getItemWidth();
            if(w === 0) return;
            const offset = (index + clonesBefore.length) * w;
            if(animate){
                isAnimating = true;
                track.style.transition = 'transform 0.45s cubic-bezier(0.4,0,0.2,1)';
            } else {
                track.style.transition = 'none';
            }
            track.style.transform = `translateX(-${offset}px)`;
            if(animate){
                setTimeout(()=>{
                    // if we walked into clones at the end
                    if(index >= realItems.length){
                        track.style.transition = 'none';
                        index = 0;
                        const realOffset = (index + clonesBefore.length) * w;
                        track.style.transform = `translateX(-${realOffset}px)`;
                    }
                    // if we walked into clones at the start
                    if(index < 0){
                        track.style.transition = 'none';
                        index = realItems.length - 1;
                        const realOffset = (index + clonesBefore.length) * w;
                        track.style.transform = `translateX(-${realOffset}px)`;
                    }
                    isAnimating = false;
                }, 480);
            }
        }

        prev?.addEventListener('click', function(){ if(isAnimating) return; index -= 1; updateTransform(true); restartAuto(); });
        next?.addEventListener('click', function(){ if(isAnimating) return; index += 1; updateTransform(true); restartAuto(); });

        function startAuto(){ stopAuto(); if(realItems.length > 1) autoInterval = setInterval(()=>{ if(!isAnimating) { index += 1; updateTransform(true); } }, 4500); }
        function stopAuto(){ if(autoInterval){ clearInterval(autoInterval); autoInterval = null; } }
        function restartAuto(){ stopAuto(); startAuto(); }

        // Pause on hover
        const container = document.querySelector('.featured-carousel-container');
        if(container){ container.addEventListener('mouseenter', stopAuto); container.addEventListener('mouseleave', startAuto); }

        // init
        buildClones();
        index = 0;
        // force a layout to pick up widths
        setTimeout(()=> updateTransform(false), 50);
        startAuto();

        // responsive rebuild
        let t;
        window.addEventListener('resize', ()=>{
            clearTimeout(t); t = setTimeout(()=>{
                // remove clones then rebuild
                buildClones();
                updateTransform(false);
            }, 250);
        });
    })();
</script>
{% load static %}
<script src="{% static 'js/home.offers.js' %}"></script>
{% endblock %}
