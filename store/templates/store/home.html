{% extends 'store/base.html' %}
{% load currency %}

{% block extra_css %}
<style>
/* Reduce space between Limited Offers heading and banner */
.limited-offers-banner {
    margin-top: -100px !important;
}
/* Limited Offers Banner Styling - Large Image Banner with Carousel */
.limited-offers-banner {
    margin-bottom: 40px;
    position: relative;
}

.offer-banner-carousel {
    position: relative;
    overflow: hidden;
    border-radius: 16px;
    min-height: 400px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    border: 2px solid rgba(25,118,210,0.3);
    transition: all 0.4s ease;
    animation: bannerGlow 3s ease-in-out infinite;
}

.offer-banner-carousel:hover {
    border-color: rgba(25,118,210,0.8);
    box-shadow: 0 8px 32px rgba(0,0,0,0.15), 
                0 0 30px rgba(25,118,210,0.6),
                0 0 60px rgba(25,118,210,0.4);
    animation: none;
}

.offer-banner-item {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    min-height: 400px;
    opacity: 0;
    visibility: hidden;
    transform: scale(0.95) translateX(50px);
    transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), 
                visibility 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    text-decoration: none;
    display: block;
    z-index: 1; /* keep banner below nav controls (nav uses much higher z-index) */
}

.offer-banner-item.active {
    opacity: 1;
    visibility: visible;
    position: relative;
    transform: scale(1) translateX(0);
}

.offer-banner-item.slide-out-left {
    transform: scale(0.95) translateX(-50px);
    opacity: 0;
}

.offer-banner-item.slide-in-right {
    transform: scale(0.95) translateX(50px);
    opacity: 0;
}

.offer-banner-item:hover {
    text-decoration: none;
}

.offer-banner-item:focus {
    outline: none;
}

.offer-banner-bg {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transform: scale(1.1);
    transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 0;
}

.offer-banner-item.active .offer-banner-bg {
    transform: scale(1);
}

.offer-banner-item:hover .offer-banner-bg {
    transform: scale(1.05);
}

.offer-banner-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.6) 100%);
    z-index: 1;
}

.offer-banner-content {
    position: relative;
    z-index: 2;
    padding: 48px;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: white;
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s,
                transform 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s;
}

.offer-banner-item.active .offer-banner-content {
    opacity: 1;
    transform: translateY(0);
}

.offer-banner-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.offer-banner-badge {
    background: rgba(239,83,80,0.95);
    padding: 12px 20px;
    border-radius: 999px;
    font-weight: 700;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 16px rgba(239,83,80,0.4);
    animation: badgePulse 2s ease-in-out infinite;
}

@keyframes badgePulse {
    0%, 100% { box-shadow: 0 4px 16px rgba(239,83,80,0.4); }
    50% { box-shadow: 0 6px 24px rgba(239,83,80,0.6); }
}

@keyframes bannerGlow {
    0%, 100% { 
        border-color: rgba(25,118,210,0.3);
        box-shadow: 0 8px 32px rgba(0,0,0,0.15), 
                    0 0 20px rgba(25,118,210,0.3);
    }
    50% { 
        border-color: rgba(25,118,210,0.5);
        box-shadow: 0 8px 32px rgba(0,0,0,0.15), 
                    0 0 40px rgba(25,118,210,0.5);
    }
}

@keyframes boltBlink {
    0%, 100% { 
        opacity: 1;
        transform: scale(1);
    }
    50% { 
        opacity: 0.3;
        transform: scale(0.9);
    }
}

.offer-banner-top .fa-bolt {
    animation: boltBlink 1.5s ease-in-out infinite;
    display: inline-block;
}

.offer-banner-title {
    font-size: 3rem;
    font-weight: 900;
    margin-bottom: 16px;
    text-shadow: 0 4px 12px rgba(0,0,0,0.5);
    line-height: 1.2;
}

.offer-banner-discount {
    font-size: 2rem;
    font-weight: 800;
    color: #FFD600;
    margin-bottom: 12px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.4);
}

.offer-banner-description {
    font-size: 1.1rem;
    margin-bottom: 24px;
    opacity: 0.95;
    line-height: 1.6;
    max-width: 600px;
}

.offer-banner-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.offer-banner-end-date {
    font-size: 0.9rem;
    opacity: 0.9;
}

.offer-progress-container {
    margin-top: 24px;
    background: rgba(255,255,255,0.2);
    height: 8px;
    border-radius: 999px;
    overflow: hidden;
}

.offer-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #FFD600, #FF6B6B);
    border-radius: 999px;
    transition: width 0.5s ease;
    box-shadow: 0 0 12px rgba(255,214,0,0.6);
}

/* Compact banner for multiple offers */
.offer-banner-compact {
    min-height: 250px;
}

.offer-banner-compact .offer-banner-title {
    font-size: 2rem;
}

.offer-banner-compact .offer-banner-discount {
    font-size: 1.5rem;
}

.offer-banner-compact .offer-banner-content {
    padding: 32px;
}

/* Fallback solid color backgrounds */
.offer-banner-solid {
    background: linear-gradient(135deg, #1976D2 0%, #0D47A1 100%);
}

/* Carousel Navigation Arrows */
.offer-carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.25);
    border: 2px solid rgba(255, 255, 255, 0.5);
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 9999;
    font-size: 1.2rem;
    backdrop-filter: blur(8px);
    outline: none;
}

.offer-carousel-nav:hover {
    background: rgba(255, 255, 255, 0.4);
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.offer-carousel-nav:focus {
    outline: 2px solid rgba(255, 255, 255, 0.8);
    outline-offset: 2px;
}

/* Ensure nav buttons receive pointer events even if parent elements add overlays */
.offer-carousel-nav { pointer-events: auto; }

/* DEBUG: temporary outline to verify nav button click areas during testing */
.offer-carousel-nav.debug-outline {
    outline: 3px solid rgba(255,0,0,0.7);
    box-shadow: 0 0 0 6px rgba(255,0,0,0.08);
}

.offer-carousel-prev {
    left: 20px;
}

.offer-carousel-next {
    right: 20px;
}

/* Carousel Indicators */
.offer-carousel-indicators {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    z-index: 10;
}

.offer-carousel-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.4);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.offer-carousel-dot:hover {
    background: rgba(255, 255, 255, 0.6);
    transform: scale(1.2);
}

.offer-carousel-dot.active {
    background: white;
    width: 30px;
    border-radius: 5px;
}

@media (max-width: 768px) {
    .offer-banner-item,
    .offer-banner-carousel {
        min-height: 300px;
    }
    
    .offer-banner-title {
        font-size: 2rem;
    }
    
    .offer-banner-discount {
        font-size: 1.5rem;
    }
    
    .offer-banner-content {
        padding: 32px 24px;
    }
    
    .offer-carousel-nav {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
    
    .offer-carousel-prev {
        left: 10px;
    }
    
    .offer-carousel-next {
        right: 10px;
    }
}

/* Light theme refinements */
.limited-offers {
    background: linear-gradient(145deg, rgba(30,40,60,0.9), rgba(15,25,45,0.95));
    border: 2px solid transparent;
    border-image: linear-gradient(135deg, rgba(30,136,229,0.3), rgba(100,181,246,0.2)) 1;
    border-radius: 12px;
    padding: 0;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 0 1px rgba(30,136,229,0.1);
    animation: borderGlow 3s ease-in-out infinite;
}

@keyframes borderGlow {
    0%, 100% { box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 20px rgba(30,136,229,0.1); }
    50% { box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 30px rgba(30,136,229,0.2); }
}

.limited-offers .lo-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 20px;
    background: linear-gradient(135deg, rgba(30,136,229,0.18), rgba(30,136,229,0.08));
    border-bottom: 1px solid rgba(30,136,229,0.2);
    backdrop-filter: blur(10px);
}

.limited-offers .lo-title {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 0;
    color: var(--text-white);
    font-weight: 700;
    font-size: 1.3rem;
    text-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.limited-offers .lo-title i {
    animation: pulse 2s ease-in-out infinite;
    filter: drop-shadow(0 0 8px rgba(255,193,7,0.6));
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.limited-offers .lo-body { padding: 20px; }

/* Enhanced Offer Cards */
.limited-offer-card {
    overflow: hidden;
    border-radius: 14px;
    border: 2px solid rgba(30,136,229,0.2) !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 20px rgba(0,0,0,0.25), 0 0 0 1px rgba(30,136,229,0.1);
    position: relative;
    min-height: 240px;
}

.limited-offer-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(30,136,229,0.1), transparent);
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 1;
    pointer-events: none;
}

.limited-offer-card:hover {
    transform: translateY(-8px) scale(1.02);
    border-color: rgba(30,136,229,0.5) !important;
    box-shadow: 0 12px 40px rgba(30,136,229,0.35), 0 0 0 1px rgba(30,136,229,0.3);
}

.limited-offer-card:hover::before {
    opacity: 1;
}

.limited-offer-card .overlay-top {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.7));
    z-index: 1;
}

.limited-offer-card .time-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 3;
    border-radius: 999px;
    padding: 8px 14px !important;
    font-weight: 600;
    font-size: 0.85rem;
    box-shadow: 0 4px 16px rgba(239,83,80,0.4);
    animation: badgePulse 2s ease-in-out infinite;
}

@keyframes badgePulse {
    0%, 100% { box-shadow: 0 4px 16px rgba(239,83,80,0.4); }
    50% { box-shadow: 0 6px 24px rgba(239,83,80,0.6); }
}

.limited-offer-card .card-body {
    position: relative;
    z-index: 2;
    padding: 24px !important;
}

.limited-offer-card .card-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 12px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.5);
}

.limited-offer-card .text-info {
    font-size: 1.1rem;
    font-weight: 700;
    text-shadow: 0 2px 6px rgba(0,0,0,0.4);
    background: linear-gradient(135deg, #64B5F6, #42A5F5);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.limited-offer-card .time-progress {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 6px;
    background: rgba(255,255,255,0.2);
    z-index: 2;
    overflow: hidden;
}

.limited-offer-card .time-progress::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: shimmer 2s linear infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.limited-offer-card .time-progress .bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #FF6B6B, #FFC107, #42A5F5);
    background-size: 200% 100%;
    animation: gradientFlow 3s ease infinite;
    transition: width 0.5s ease;
    box-shadow: 0 0 10px rgba(66,165,245,0.6);
    position: relative;
    z-index: 1;
}

@keyframes gradientFlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .limited-offers .lo-title {
        font-size: 1.1rem;
    }
    
    .limited-offer-card {
        min-height: 200px;
    }
    
    .limited-offer-card .card-body {
        padding: 18px !important;
    }
}

/* Light theme refinements */
html[data-theme='light'] .limited-offers {
    background: linear-gradient(145deg, #FFFFFF, #F5F9FF);
    border-image: linear-gradient(135deg, rgba(25,118,210,0.3), rgba(66,165,245,0.2)) 1;
    box-shadow: 0 8px 32px rgba(25,118,210,0.15), 0 0 0 1px rgba(25,118,210,0.1);
}

html[data-theme='light'] .limited-offers .lo-header {
    background: linear-gradient(135deg, rgba(25,118,210,0.12), rgba(25,118,210,0.06));
    border-bottom-color: rgba(25,118,210,0.15);
}

html[data-theme='light'] .limited-offers .lo-title {
    color: var(--light-text);
    text-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

html[data-theme='light'] .limited-offer-card {
    border-color: rgba(25,118,210,0.25) !important;
    box-shadow: 0 4px 20px rgba(25,118,210,0.12), 0 0 0 1px rgba(25,118,210,0.08);
}

html[data-theme='light'] .limited-offer-card:hover {
    border-color: rgba(25,118,210,0.5) !important;
    box-shadow: 0 12px 40px rgba(25,118,210,0.25), 0 0 0 1px rgba(25,118,210,0.3);
}

html[data-theme='light'] .limited-offer-card .overlay-top {
    background: linear-gradient(180deg, rgba(255,255,255,0.2), rgba(255,255,255,0.4));
}

/* Categories Carousel Styling */

.categories-carousel-container {
    position: relative;
    padding: 0 80px;
    margin-top: 30px;
    overflow: hidden;
}

.categories-carousel-track {
    display: flex;
    gap: 30px;
    transition: transform 0.5s cubic-bezier(0.4,0,0.2,1);
    will-change: transform;
}

.category-carousel-item {
    min-width: 0;
    flex: 0 0 calc(100%/3 - 20px);
    transition: opacity 0.3s, box-shadow 0.3s;
}

@media (max-width: 1200px) {
    .category-carousel-item {
        flex: 0 0 calc(50% - 15px);
    }
}
@media (max-width: 768px) {
    .categories-carousel-container {
        padding: 0 60px;
    }
    .category-carousel-item {
        flex: 0 0 100%;
    }
}

.category-carousel-item .card {
    height: 100%;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.category-carousel-item .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(30,136,229,0.3);
}

.category-carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(30, 136, 229, 0.15);
    border: 2px solid var(--accent-blue);
    color: var(--accent-blue);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    font-size: 1.2rem;
    backdrop-filter: blur(8px);
}

.category-carousel-nav:hover {
    background: var(--accent-blue);
    color: white;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 5px 15px rgba(30, 136, 229, 0.3);
}

.category-carousel-prev {
    left: 10px;
}

.category-carousel-next {
    right: 10px;
}

/* Light theme */
html[data-theme='light'] .category-carousel-nav {
    background: rgba(25, 118, 210, 0.1);
    border-color: var(--light-accent);
    color: var(--light-accent);
}

html[data-theme='light'] .category-carousel-nav:hover {
    background: var(--light-accent);
    color: white;
}

/* Responsive */
@media (max-width: 1200px) {
    .categories-carousel-track {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .categories-carousel-container {
        padding: 0 60px;
    }
    
    .categories-carousel-track {
        grid-template-columns: 1fr;
    }
    
    .category-carousel-nav {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
    
    .category-carousel-prev {
        left: 5px;
    }
    
    .category-carousel-next {
        right: 5px;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Hero Section with Carousel -->
<div class="hero-section">
    {% load static %}
    
    <!-- Hero Slide 1 -->
    <div class="hero-slide active">
        {% if categories.0.image %}
        <img src="{{ categories.0.image.url }}" alt="Aquatic Fish" class="hero-image">
        {% else %}
        <img src="{% static 'images/hero-betta-fish.png' %}" alt="Aquatic Fish" class="hero-image">
        {% endif %}
        <div class="hero-content">
            <h1 class="hero-title">{{ SITE_NAME|upper }}</h1>
            <p class="hero-subtitle">The largest collection of beautiful aquatic fishes. Discover rare breeds and exotic species from around the world.</p>
            {% if user.is_authenticated and user.role == 'customer' %}
                
            {% elif not user.is_authenticated %}
                <div class="mt-4">
                    <a href="{% url 'register' %}" class="btn btn-primary btn-lg btn-register">
                        <i class="fas fa-user-plus"></i> Get Started
                    </a>
                    <a href="{% url 'fish_list' %}" class="btn btn-success btn-lg ms-3">
                        <i class="fas fa-eye"></i> Browse Fishes
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Hero Slide 2 -->
    <div class="hero-slide">
        {% if categories.1.image %}
        <img src="{{ categories.1.image.url }}" alt="Aquatic Fish" class="hero-image">
        {% else %}
        <img src="{% static 'images/image1.png' %}" alt="Aquatic Fish" class="hero-image">
        {% endif %}
        <div class="hero-content">
            <h1 class="hero-title">{{ SITE_NAME|upper }}</h1>
            <p class="hero-subtitle">Premium quality fish from trusted breeders. Each fish is carefully selected for health, beauty, and vitality.</p>
            {% if user.is_authenticated and user.role == 'customer' %}
                
            {% elif not user.is_authenticated %}
                <div class="mt-4">
                    <a href="{% url 'register' %}" class="btn btn-primary btn-lg btn-register">
                        <i class="fas fa-user-plus"></i> Get Started
                    </a>
                    <a href="{% url 'fish_list' %}" class="btn btn-success btn-lg ms-3">
                        <i class="fas fa-eye"></i> Browse Fishes
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Hero Slide 3 -->
    <div class="hero-slide">
        {% if categories.2.image %}
        <img src="{{ categories.2.image.url }}" alt="Aquatic Fish" class="hero-image">
        {% else %}
        <img src="{% static 'images/image.png' %}" alt="Aquatic Fish" class="hero-image">
        {% endif %}
        <div class="hero-content">
            <h1 class="hero-title">{{ SITE_NAME|upper }}</h1>
            <p class="hero-subtitle">Transform your aquarium into a masterpiece. Browse our exclusive collection of vibrant, exotic aquatic species.</p>
            {% if user.is_authenticated and user.role == 'customer' %}
                
            {% elif not user.is_authenticated %}
                <div class="mt-4">
                    <a href="{% url 'register' %}" class="btn btn-primary btn-lg btn-register">
                        <i class="fas fa-user-plus"></i> Get Started
                    </a>
                    <a href="{% url 'fish_list' %}" class="btn btn-success btn-lg ms-3">
                        <i class="fas fa-eye"></i> Browse Fishes
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Navigation Arrows -->
    <button class="hero-nav hero-nav-prev" id="heroPrev" aria-label="Previous slide">
        <i class="fas fa-chevron-left"></i>
    </button>
    <button class="hero-nav hero-nav-next" id="heroNext" aria-label="Next slide">
        <i class="fas fa-chevron-right"></i>
    </button>
    
    <!-- Indicator Dots -->
    
</div>

<!-- About Section -->
{% if limited_offers %}
<!-- Limited Offers Heading + Banner -->
<section class="section">
    <div class="container-fluid">
        <h2 class="section-heading">Limited Offers</h2>
    </div>
</section>
        <section class="limited-offers-banner">
            <div class="container-fluid">
                <div class="offer-banner-carousel">
                    {% for offer in limited_offers %}
                    <a href="{% if offer.fish %}{% url 'fish_detail' offer.fish.id %}{% else %}{% url 'fish_list' %}{% endif %}" class="offer-banner-item {% if forloop.first %}active{% endif %}" data-start-time="{{ offer.start_time|date:'c' }}" data-end-time="{{ offer.end_time|date:'c' }}">
                        {% if offer.fish and offer.fish.image %}
                        <div class="offer-banner-bg" style="background-image: url('{{ offer.fish.image.url }}');"></div>
                        <div class="offer-banner-overlay"></div>
                        {% elif offer.image %}
                        <div class="offer-banner-bg" style="background-image: url('{{ offer.image.url }}');"></div>
                        <div class="offer-banner-overlay"></div>
                        {% elif offer.bg_color %}
                        <div class="offer-banner-bg" style="background: {{ offer.bg_color }};"></div>
                        <div class="offer-banner-overlay"></div>
                        {% else %}
                        <div class="offer-banner-bg offer-banner-solid"></div>
                        <div class="offer-banner-overlay"></div>
                        {% endif %}
                        
                        <div class="offer-banner-content">
                            <div class="offer-banner-top">
                                <div>
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-bolt text-warning me-2" style="font-size: 1.5rem;"></i>
                                        <span style="font-size: 1rem; font-weight: 600; opacity: 0.9;">LIMITED TIME OFFER</span>
                                    </div>
                                    <h2 class="offer-banner-title">{{ offer.title }}</h2>
                                    <div class="offer-banner-discount">{{ offer.discount_text }}</div>
                                    {% if offer.description %}
                                    <p class="offer-banner-description">{{ offer.description }}</p>
                                    {% endif %}
                                    {% if offer.fish %}
                                    <p class="offer-banner-fish-info" style="font-size: 1rem; margin-top: 12px; opacity: 0.9;">
                                        <i class="fas fa-fish me-2"></i>{{ offer.fish.name }} - {{ offer.fish.breed.name }}
                                    </p>
                                    {% endif %}
                                </div>
                                <div class="offer-banner-badge">
                                    <i class="far fa-clock"></i>
                                    <span class="countdown-banner" data-end-time="{{ offer.end_time|date:'c' }}">--:--:--</span>
                                </div>
                            </div>
                            
                            <div class="offer-banner-footer">
                                <div class="offer-banner-end-date">
                                    <i class="far fa-calendar-alt me-2"></i>
                                    Ends {{ offer.end_time|date:"M d, Y g:i A" }}
                                </div>
                            </div>
                            
                            <div class="offer-progress-container">
                                <div class="offer-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                    
                    <!-- Navigation Arrows (always rendered so client-side can control visibility) -->
                    <button class="offer-carousel-nav offer-carousel-prev" id="offerCarouselPrev" aria-label="Previous offer" title="Previous offer" tabindex="0" aria-controls="offerCarousel">
                        <i class="fas fa-chevron-left" aria-hidden="true"></i>
                    </button>
                    <button class="offer-carousel-nav offer-carousel-next" id="offerCarouselNext" aria-label="Next offer" title="Next offer" tabindex="0" aria-controls="offerCarousel">
                        <i class="fas fa-chevron-right" aria-hidden="true"></i>
                    </button>

                    <!-- Indicator Dots removed: UI simplified by hiding the small dots -->
                </div>
            </div>
        </section>
    {% endif %}

<!-- Categories Section -->
{% if categories %}
    <div class="container-fluid">
        <h2 class="section-heading">Categories</h2>
        <div class="categories-carousel-container">
            <div class="categories-carousel-track">
                {% for category in categories %}
                <div class="category-carousel-item">
                    <div class="card category-card">
                        {% if category.image %}
                        <img src="{{ category.image.url }}" class="card-img-top" alt="{{ category.name }}">
                        {% else %}
                        <div class="card-img-top" style="height: 250px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-light-blue)); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-fish fa-5x" style="opacity: 0.3;"></i>
                        </div>
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ category.name }}</h5>
                            <p class="card-text">{{ category.description|truncatewords:20 }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Navigation Buttons -->
            <button class="category-carousel-nav category-carousel-prev" id="categoryPrev" aria-label="Previous categories">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="category-carousel-nav category-carousel-next" id="categoryNext" aria-label="Next categories">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
{% endif %}

<!-- Featured Fishes Section -->
{% if fishes %}
<section class="section">
    <div class="container-fluid">
        <h2 class="section-heading">Featured Fishes</h2>

        <style>
        /* Featured carousel: horizontal track + cards */
        .featured-carousel-container { position: relative; overflow: hidden; padding: 10px 0; }
        .featured-carousel-track { display: flex; gap: 24px; transition: transform 0.5s cubic-bezier(0.4,0,0.2,1); will-change: transform; align-items: stretch; }
        .featured-item { flex: 0 0 auto; width: calc(25% - 18px); }
        .featured-item .card { height: 100%; }

        @media (max-width: 1200px) { .featured-item { width: calc(33.333% - 16px); } }
        @media (max-width: 768px)  { .featured-item { width: calc(50% - 12px); } }
        @media (max-width: 576px)  { .featured-item { width: calc(100% - 8px); } }

        .featured-carousel-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.15); color: var(--text-white); width: 44px; height: 44px; border-radius: 50%; display:flex; align-items:center; justify-content:center; z-index: 10; cursor:pointer; }
        .featured-carousel-nav:hover { transform: translateY(-50%) scale(1.05); background: rgba(255,255,255,0.18); }
        .featured-prev { left: 8px; }
        .featured-next { right: 8px; }
        </style>

        <div class="featured-carousel-container">
            <div class="featured-carousel-track">
                {% for fish in fishes %}
                <div class="featured-item">
                    <div class="card">
                        {% if fish.image %}
                        <img src="{{ fish.image.url }}" class="card-img-top" alt="{{ fish.name }}">
                        {% else %}
                        <div class="card-img-top" style="height: 250px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-light-blue)); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-fish fa-5x" style="opacity: 0.3;"></i>
                        </div>
                        {% endif %}
                        <div class="card-body">
                            <span class="category-badge">{{ fish.category.name }}</span>
                            <h5 class="card-title mt-2">{{ fish.name }}</h5>
                            <p class="card-text">{{ fish.description|truncatewords:15 }}</p>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <span class="price-badge">{{ fish.price|rupees }}</span>
                                {% if user.is_authenticated and user.role == 'customer' %}
                                    <a href="{% url 'fish_detail' fish.id %}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                {% elif not user.is_authenticated %}
                                    <a href="{% url 'login' %}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Nav -->
            <button class="featured-carousel-nav featured-prev" id="featuredPrev" aria-label="Previous featured">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="featured-carousel-nav featured-next" id="featuredNext" aria-label="Next featured">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</section>
{% endif %}

<!-- Reviews Section -->
{% if reviews %}
<section class="section review-section" style="padding: 80px 0;">
    <div class="container-fluid">
        <h2 class="section-heading mb-5">What Customers Say</h2>
        <div class="review-carousel-container" style="max-width: 1000px; margin: 0 auto; position: relative;">
            <div id="reviewCarouselTrack" style="min-height: 280px; padding: 40px 80px;">
                {% for r in reviews %}
                <div class="review-slide" style="display:none;">
                    <div class="d-flex flex-column align-items-center text-center">
                        <!-- Star Rating -->
                        <div class="mb-4" style="font-size: 1.5rem;">
                            {% for ch in '12345' %}
                                {% if forloop.counter <= r.rating %}
                                    <i class="fas fa-star" style="color:#FFC107;"></i>
                                {% else %}
                                    <i class="far fa-star" style="color:#FFE082;"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        
                        <!-- Review Comment -->
                        <div class="mb-4" style="position: relative;">
                            <i class="fas fa-quote-left" style="position: absolute; left: -30px; top: -10px; font-size: 2rem; color: var(--accent-blue); opacity: 0.3;"></i>
                            <p class="text-white" style="max-width: 700px; font-size: 1.1rem; line-height: 1.9; font-weight: 300; padding: 0 20px; word-break: break-word; white-space: pre-line;">
                                {{ r.comment|default:'Great experience! Highly recommended.' }}
                            </p>
                            <i class="fas fa-quote-right" style="position: absolute; right: -30px; bottom: -10px; font-size: 2rem; color: var(--accent-blue); opacity: 0.3;"></i>
                        </div>
                        
                        <!-- User Info -->
                        <div class="mt-3">
                            <div class="mb-2">
                                <span class="text-white" style="font-size: 1rem; font-weight: 500;">
                                    <i class="fas fa-user-circle me-2" style="color: var(--accent-blue);"></i>{{ r.user.username }}
                                </span>
                            </div>
                            <div class="mt-2">
                                <small class="text-muted" style="font-size: 0.75rem;">
                                    <i class="far fa-calendar-alt me-1"></i>{{ r.created_at|date:"M d, Y" }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Navigation Arrows -->
            <button id="reviewPrev" class="review-nav-btn review-nav-prev" aria-label="Previous review">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="reviewNext" class="review-nav-btn review-nav-next" aria-label="Next review">
                <i class="fas fa-chevron-right"></i>
            </button>
            
            <!-- Indicator Dots -->

        </div>
    </div>
</section>

<style>
.review-section {
    background: var(--darker-bg);
}

html[data-theme='light'] .review-section {
    background: var(--light-surface);
}

.review-carousel-container {
    position: relative;
}

.review-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(30, 136, 229, 0.15);
    border: 2px solid var(--accent-blue);
    color: var(--accent-blue);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    font-size: 1.2rem;
}

.review-nav-btn:hover {
    background: var(--accent-blue);
    color: white;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 5px 15px rgba(30, 136, 229, 0.3);
}

.review-nav-prev {
    left: 10px;
}

.review-nav-next {
    right: 10px;
}

.review-indicators {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 30px;
}

.review-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
}

.review-dot:hover {
    background: rgba(255, 255, 255, 0.5);
    transform: scale(1.2);
}

.review-dot.active {
    background: var(--accent-blue);
    width: 30px;
    border-radius: 5px;
}

html[data-theme='light'] .review-nav-btn {
    background: rgba(25, 118, 210, 0.1);
    border-color: var(--light-accent);
    color: var(--light-accent);
}

html[data-theme='light'] .review-nav-btn:hover {
    background: var(--light-accent);
    color: white;
}

html[data-theme='light'] .review-dot {
    background: rgba(0, 0, 0, 0.2);
}

html[data-theme='light'] .review-dot:hover {
    background: rgba(0, 0, 0, 0.4);
}

html[data-theme='light'] .review-dot.active {
    background: var(--light-accent);
}

@media (max-width: 768px) {
    #reviewCarouselTrack {
        padding: 40px 60px !important;
    }
    
    .review-nav-btn {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
    
    .review-nav-prev {
        left: 5px;
    }
    
    .review-nav-next {
        right: 5px;
    }
}
</style>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
// Hero Carousel
document.addEventListener('DOMContentLoaded', function(){
    try {
        console.debug('home.js DOMContentLoaded');
    const heroSlides = document.querySelectorAll('.hero-slide');
    const heroDots = document.querySelectorAll('.hero-dot');
    const heroPrevBtn = document.getElementById('heroPrev');
    const heroNextBtn = document.getElementById('heroNext');
    
    let heroIdx = 0;
    let heroAutoPlayInterval;
    
    function showHeroSlide(i){
        heroSlides.forEach((slide, j) => {
            if(j === i) {
                slide.classList.add('active');
            } else {
                slide.classList.remove('active');
            }
        });
        
        heroDots.forEach((dot, j) => {
            if(j === i) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    }
    
    function nextHeroSlide(){
        heroIdx = (heroIdx + 1) % heroSlides.length;
        showHeroSlide(heroIdx);
    }
    
    function prevHeroSlide(){
        heroIdx = (heroIdx - 1 + heroSlides.length) % heroSlides.length;
        showHeroSlide(heroIdx);
    }
    
    function startHeroAutoPlay(){
        stopHeroAutoPlay();
        heroAutoPlayInterval = setInterval(nextHeroSlide, 5000);
    }
    
    function stopHeroAutoPlay(){
        if(heroAutoPlayInterval){
            clearInterval(heroAutoPlayInterval);
        }
    }
    
    // Initialize hero carousel
    if(heroSlides.length > 0){
        showHeroSlide(heroIdx);
        startHeroAutoPlay();
        
        // Navigation buttons
        heroNextBtn?.addEventListener('click', function(){
            nextHeroSlide();
            stopHeroAutoPlay();
            startHeroAutoPlay();
        });
        
        heroPrevBtn?.addEventListener('click', function(){
            prevHeroSlide();
            stopHeroAutoPlay();
            startHeroAutoPlay();
        });
        
        // Dot indicators
        heroDots.forEach((dot, i) => {
            dot.addEventListener('click', function(){
                heroIdx = i;
                showHeroSlide(heroIdx);
                stopHeroAutoPlay();
                startHeroAutoPlay();
            });
        });
        
        // Pause on hover
        const heroSection = document.querySelector('.hero-section');
        if(heroSection){
            heroSection.addEventListener('mouseenter', stopHeroAutoPlay);
            heroSection.addEventListener('mouseleave', startHeroAutoPlay);
        }
    }
    
    // Enhanced review carousel with indicators
    const track = document.querySelector('#reviewCarouselTrack');
    if(track) {

    const items = track.querySelectorAll('.review-slide');
    const dots = document.querySelectorAll('.review-dot');

    const prevBtn = document.getElementById('reviewPrev');
    const nextBtn = document.getElementById('reviewNext');
    
    let idx = 0;
    let reviewAutoPlayInterval;
    
    function show(i){
        items.forEach((el, j) => {
            el.style.display = j === i ? 'block' : 'none';
        });
        
        dots.forEach((dot, j) => {
            if(j === i) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    }
    
    function next(){
        idx = (idx + 1) % items.length;
        show(idx);
    }
    
    function prev(){
        idx = (idx - 1 + items.length) % items.length;
        show(idx);
    }
    
    function startAutoPlay(){
        stopAutoPlay();
        reviewAutoPlayInterval = setInterval(next, 5000);
    }
    
    function stopAutoPlay(){
        if(reviewAutoPlayInterval){
            clearInterval(reviewAutoPlayInterval);
        }
    }
    
    // Initialize
    show(idx);
    startAutoPlay();
    
    // Navigation buttons
    nextBtn?.addEventListener('click', function(){
        next();
        stopAutoPlay();
        startAutoPlay();
    });
    
    prevBtn?.addEventListener('click', function(){
        prev();
        stopAutoPlay();
        startAutoPlay();
    });
    
    // Dot indicators (if any)
    if(dots && dots.length){
        dots.forEach((dot, i) => {
            dot.addEventListener('click', function(){
                idx = i;
                show(idx);
                stopAutoPlay();
                startAutoPlay();
            });
        });
    }
    
    // Pause on hover
    track.addEventListener('mouseenter', stopAutoPlay);
    track.addEventListener('mouseleave', startAutoPlay);

    } // end if(track)
    
    // Offer Banner Carousel (scoped, single-binding, robust)
    (function(){
        const offerCarousel = document.querySelector('.offer-banner-carousel');
        if(!offerCarousel) return;

        const banners = Array.from(offerCarousel.querySelectorAll('.offer-banner-item'));
        const prevBtn = offerCarousel.querySelector('#offerCarouselPrev') || document.getElementById('offerCarouselPrev');
        const nextBtn = offerCarousel.querySelector('#offerCarouselNext') || document.getElementById('offerCarouselNext');
        const dots = Array.from(offerCarousel.querySelectorAll('.offer-carousel-dot'));

        if(banners.length === 0) return;

        let idx = banners.findIndex(b => b.classList.contains('active'));
        if(idx === -1) idx = 0;
        let autoInterval = null;

        function show(i){
            banners.forEach((b, j) => b.classList.toggle('active', j === i));
            dots.forEach((d, j) => d.classList.toggle('active', j === i));
        }

        function next(){
            idx = (idx + 1) % banners.length;
            show(idx);
        }

        function prev(){
            idx = (idx - 1 + banners.length) % banners.length;
            show(idx);
        }

        function startAuto(){
            stopAuto();
            if(banners.length > 1) autoInterval = setInterval(next, 5000);
        }

        function stopAuto(){
            if(autoInterval){ clearInterval(autoInterval); autoInterval = null; }
        }

        // Single, defensive binding for controls
        if(nextBtn && !nextBtn.__offerBound){
            nextBtn.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); next(); stopAuto(); startAuto(); });
            nextBtn.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar'){ e.preventDefault(); nextBtn.click(); } });
            nextBtn.__offerBound = true;
        }

        if(prevBtn && !prevBtn.__offerBound){
            prevBtn.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); prev(); stopAuto(); startAuto(); });
            prevBtn.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar'){ e.preventDefault(); prevBtn.click(); } });
            prevBtn.__offerBound = true;
        }

        // Dot bindings
        if(dots.length){
            dots.forEach((dot, i) => {
                if(!dot.__offerBound){
                    dot.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); idx = i; show(idx); stopAuto(); startAuto(); });
                    dot.__offerBound = true;
                }
            });
        }

        // Pause on hover for the whole carousel element
        offerCarousel.addEventListener('mouseenter', stopAuto);
        offerCarousel.addEventListener('mouseleave', startAuto);

        // Initialize
        show(idx);
        startAuto();
    })();
    
    // Limited Offers Banner: countdown + progress bars
    function fmt(n){ return n.toString().padStart(2,'0'); }
    function updateOfferBanners(){
        const banners = document.querySelectorAll('.offer-banner-item');
        const now = Date.now();
        banners.forEach(banner => {
            const startStr = banner.getAttribute('data-start-time');
            const endStr = banner.getAttribute('data-end-time');
            const start = new Date(startStr).getTime();
            const end = new Date(endStr).getTime();
            const countdown = banner.querySelector('.countdown-banner');
            const progressBar = banner.querySelector('.offer-progress-bar');
            if (!isFinite(start) || !isFinite(end) || !countdown || !progressBar) return;

            // Countdown with days/hours/minutes format
            if (now < start) {
                let untilStart = Math.floor((start - now)/1000);
                if (untilStart > 0) {
                    let d = Math.floor(untilStart/86400); untilStart%=86400;
                    let h = Math.floor(untilStart/3600); untilStart%=3600;
                    let m = Math.floor(untilStart/60);
                    countdown.textContent = d>0 ? `Starts in ${d}d ${fmt(h)}h ${fmt(m)}m` : `Starts in ${fmt(h)}h ${fmt(m)}m`;
                    progressBar.style.width = '0%';
                    return;
                }
            }
            
            let diff = Math.floor((end - now)/1000);
            if (isNaN(diff) || diff <= 0) {
                countdown.textContent = 'Expired';
                progressBar.style.width = '100%';
            } else {
                let d = Math.floor(diff/86400); diff%=86400;
                let h = Math.floor(diff/3600); diff%=3600;
                let m = Math.floor(diff/60);
                countdown.textContent = d>0 ? `${d}d ${fmt(h)}h ${fmt(m)}m` : `${fmt(h)}h ${fmt(m)}m`;
            }

            // Progress bar
            const total = Math.max(1, end - start);
            const elapsed = Math.min(Math.max(0, now - start), total);
            const pct = Math.round((elapsed/total)*100);
            progressBar.style.width = `${pct}%`;
        });
    }
    updateOfferBanners();
    setInterval(updateOfferBanners, 1000);

    // Categories Carousel: Card Switch 1 at a Time (infinite looping)
    const categoryItems = document.querySelectorAll('.category-carousel-item');
    const categoryTrack = document.querySelector('.categories-carousel-track');
    const categoryPrevBtn = document.getElementById('categoryPrev');
    const categoryNextBtn = document.getElementById('categoryNext');

    function getItemsPerPage() {
        if(window.innerWidth > 1200) return 3;
        if(window.innerWidth > 768) return 2;
        return 1;
    }

    if(categoryItems.length > 0 && categoryTrack){
        let categoryStartIndex = 0; // index into realItems
        let itemsPerPage = getItemsPerPage();
        let isAnimating = false;
        let categoryAutoPlayInterval = null;

        // Real (original) items
        const realItems = Array.from(categoryItems);
        let clonesPrepended = [];
        let clonesAppended = [];
        const GAP = 30; // px gap used in CSS

        function setupClones() {
            // Remove old clones
            clonesPrepended.forEach(node => node.remove());
            clonesAppended.forEach(node => node.remove());
            clonesPrepended = [];
            clonesAppended = [];

            itemsPerPage = getItemsPerPage();
            // Clone last N items and prepend (in order)
            for(let i = realItems.length - itemsPerPage; i < realItems.length; i++){
                const idx = (i + realItems.length) % realItems.length;
                const clone = realItems[idx].cloneNode(true);
                clone.classList.add('category-clone');
                categoryTrack.insertBefore(clone, categoryTrack.firstChild);
                clonesPrepended.push(clone);
            }

            // Clone first N items and append (in order)
            for(let i = 0; i < itemsPerPage; i++){
                const clone = realItems[i].cloneNode(true);
                clone.classList.add('category-clone');
                categoryTrack.appendChild(clone);
                clonesAppended.push(clone);
            }
        }

        function getItemWidth(){
            const first = realItems[0];
            if(!first) return 0;
            return first.offsetWidth + GAP;
        }

        function updateCategoryTransform(animate = true){
            if(isAnimating) return;
            const itemWidth = getItemWidth();
            if(itemWidth === 0) return;

            const cloneCount = clonesPrepended.length;
            const offset = (categoryStartIndex + cloneCount) * itemWidth;

            if(animate) {
                isAnimating = true;
                categoryTrack.style.transition = 'transform 0.5s cubic-bezier(0.4,0,0.2,1)';
            } else {
                categoryTrack.style.transition = 'none';
            }

            categoryTrack.style.transform = `translateX(-${offset}px)`;

            if(animate){
                setTimeout(() => {
                    // If we've moved into prepended clones (index < 0)
                    if(categoryStartIndex < 0){
                        categoryTrack.style.transition = 'none';
                        categoryStartIndex = realItems.length - 1;
                        const realOffset = (categoryStartIndex + cloneCount) * itemWidth;
                        categoryTrack.style.transform = `translateX(-${realOffset}px)`;
                    }

                    // If we've moved into appended clones (index >= real length)
                    if(categoryStartIndex >= realItems.length){
                        categoryTrack.style.transition = 'none';
                        categoryStartIndex = 0;
                        const realOffset = (categoryStartIndex + cloneCount) * itemWidth;
                        categoryTrack.style.transform = `translateX(-${realOffset}px)`;
                    }

                    isAnimating = false;
                }, 500);
            }
        }

        categoryPrevBtn?.addEventListener('click', function(){
            if(isAnimating) return;
            itemsPerPage = getItemsPerPage();
            categoryStartIndex -= 1;
            updateCategoryTransform(true);
        });

        categoryNextBtn?.addEventListener('click', function(){
            if(isAnimating) return;
            itemsPerPage = getItemsPerPage();
            categoryStartIndex += 1;
            updateCategoryTransform(true);
        });

        // Auto-play
        function startAutoPlay(){
            stopAutoPlay();
            categoryAutoPlayInterval = setInterval(() => {
                if(isAnimating) return;
                categoryNextBtn?.click();
            }, 5000);
        }
        function stopAutoPlay(){
            if(categoryAutoPlayInterval) clearInterval(categoryAutoPlayInterval);
        }

        // Pause on hover
        const carouselContainer = document.querySelector('.categories-carousel-container');
        if(carouselContainer){
            carouselContainer.addEventListener('mouseenter', stopAutoPlay);
            carouselContainer.addEventListener('mouseleave', startAutoPlay);
        }

        // Initialize
        setupClones();
        // Start at first real item
        categoryStartIndex = 0;
        updateCategoryTransform(false);
        startAutoPlay();

        // Responsive: recalculate on resize
        let resizeTimer;
        window.addEventListener('resize', function(){
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                // Remove existing clones and rebuild for new itemsPerPage
                setupClones();
                // Ensure index is within bounds
                if(categoryStartIndex > realItems.length - 1){
                    categoryStartIndex = 0;
                }
                updateCategoryTransform(false);
            }, 250);
        });
    }
    } catch(err) {
        console.error('home.js uncaught error:', err);
    }
});

    // Featured fishes carousel (infinite loop with clones)
    (function(){
        const track = document.querySelector('.featured-carousel-track');
        const items = track ? Array.from(track.children) : [];
        const prev = document.getElementById('featuredPrev');
        const next = document.getElementById('featuredNext');
        if(!track || items.length === 0) return;

        const GAP = 24; // matches CSS gap
        let itemsPerPage = () => {
            if(window.innerWidth > 1200) return 4;
            if(window.innerWidth > 768) return 3;
            if(window.innerWidth > 576) return 2;
            return 1;
        };

        let realItems = items;
        let clonesBefore = [];
        let clonesAfter = [];
        let index = 0; // index into realItems
        let isAnimating = false;
        let autoInterval = null;

        function getItemWidth(){
            const el = realItems[0];
            if(!el) return 0;
            return el.offsetWidth + GAP;
        }

        function buildClones(){
            // remove existing clones
            clonesBefore.forEach(c=>c.remove()); clonesAfter.forEach(c=>c.remove()); clonesBefore=[]; clonesAfter=[];
            const n = itemsPerPage();
            for(let i = realItems.length - n; i < realItems.length; i++){
                const idx = (i + realItems.length) % realItems.length;
                const clone = realItems[idx].cloneNode(true);
                clone.classList.add('featured-clone');
                track.insertBefore(clone, track.firstChild);
                clonesBefore.push(clone);
            }
            for(let i = 0; i < n; i++){
                const clone = realItems[i].cloneNode(true);
                clone.classList.add('featured-clone');
                track.appendChild(clone);
                clonesAfter.push(clone);
            }
        }

        function updateTransform(animate=true){
            if(isAnimating) return;
            const w = getItemWidth();
            if(w === 0) return;
            const offset = (index + clonesBefore.length) * w;
            if(animate){
                isAnimating = true;
                track.style.transition = 'transform 0.45s cubic-bezier(0.4,0,0.2,1)';
            } else {
                track.style.transition = 'none';
            }
            track.style.transform = `translateX(-${offset}px)`;
            if(animate){
                setTimeout(()=>{
                    // if we walked into clones at the end
                    if(index >= realItems.length){
                        track.style.transition = 'none';
                        index = 0;
                        const realOffset = (index + clonesBefore.length) * w;
                        track.style.transform = `translateX(-${realOffset}px)`;
                    }
                    // if we walked into clones at the start
                    if(index < 0){
                        track.style.transition = 'none';
                        index = realItems.length - 1;
                        const realOffset = (index + clonesBefore.length) * w;
                        track.style.transform = `translateX(-${realOffset}px)`;
                    }
                    isAnimating = false;
                }, 480);
            }
        }

        prev?.addEventListener('click', function(){ if(isAnimating) return; index -= 1; updateTransform(true); restartAuto(); });
        next?.addEventListener('click', function(){ if(isAnimating) return; index += 1; updateTransform(true); restartAuto(); });

        function startAuto(){ stopAuto(); if(realItems.length > 1) autoInterval = setInterval(()=>{ if(!isAnimating) { index += 1; updateTransform(true); } }, 4500); }
        function stopAuto(){ if(autoInterval){ clearInterval(autoInterval); autoInterval = null; } }
        function restartAuto(){ stopAuto(); startAuto(); }

        // Pause on hover
        const container = document.querySelector('.featured-carousel-container');
        if(container){ container.addEventListener('mouseenter', stopAuto); container.addEventListener('mouseleave', startAuto); }

        // init
        buildClones();
        index = 0;
        // force a layout to pick up widths
        setTimeout(()=> updateTransform(false), 50);
        startAuto();

        // responsive rebuild
        let t;
        window.addEventListener('resize', ()=>{
            clearTimeout(t); t = setTimeout(()=>{
                // remove clones then rebuild
                buildClones();
                updateTransform(false);
            }, 250);
        });
    })();
</script>
{% load static %}
<script src="{% static 'js/home.offers.js' %}"></script>
{% endblock %}
