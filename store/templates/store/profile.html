{% extends 'store/base.html' %}

{% block extra_css %}
<script>
// Apply stored theme as early as possible on this page
(function(){
    try {
        const t = localStorage.getItem('theme');
        if (t === 'light' || t === 'dark') {
            document.documentElement.setAttribute('data-theme', t);
        }
    } catch(e) {}
})();
</script>
<style>
        /* Theme-aware static profile text colors */
        .profile-label { color: var(--text-white); font-weight:600; font-size:0.9rem; }
        .profile-value { color: var(--text-gray); font-size:0.9rem; }
        .profile-name { color: var(--text-white); font-weight:600; }
        html[data-theme='light'] .profile-label { color: var(--light-text); }
        html[data-theme='light'] .profile-value { color: var(--light-text-soft); }
        html[data-theme='light'] .profile-name { color: var(--light-text); }
        .profile-row i { margin-right:4px; color: var(--accent-blue); }
        html[data-theme='light'] .profile-row i { color: var(--light-accent); }
    </style>
{% endblock %}

{% block content %}
<section class="section">
    <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="section-heading m-0">My Profile</h2>
                        <button id="profileThemeToggle" class="btn btn-theme-toggle">
                                <i class="fas fa-moon me-2"></i>
                                <span class="label">Dark</span>
                        </button>
                </div>

        <div class="row align-items-stretch">
            <div class="col-md-8 mb-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column" style="padding: 40px;">
                        <div class="text-center mb-4">
                            {% if user.profile_picture %}
                            <img src="{{ user.profile_picture.url }}" alt="Profile" 
                                 style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-blue);">
                            {% else %}
                            <div style="width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-light-blue)); display: inline-flex; align-items: center; justify-content: center; border: 3px solid var(--accent-blue);">
                                <i class="fas fa-user fa-4x text-white"></i>
                            </div>
                            {% endif %}
                            <h3 class="mt-3 profile-name">{{ user.get_full_name|default:user.username }}</h3>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div class="row mb-3 profile-row">
                            <div class="col-md-4"><strong class="profile-label"><i class="fas fa-user"></i> Username:</strong></div>
                            <div class="col-md-8"><span class="profile-value">{{ user.username }}</span></div>
                        </div>
                        
                        <div class="row mb-3 profile-row">
                            <div class="col-md-4"><strong class="profile-label"><i class="fas fa-envelope"></i> Email:</strong></div>
                            <div class="col-md-8"><span class="profile-value">{{ user.email }}</span></div>
                        </div>
                        
                        {% if user.first_name or user.last_name %}
                        <div class="row mb-3 profile-row">
                            <div class="col-md-4"><strong class="profile-label"><i class="fas fa-id-card"></i> Full Name:</strong></div>
                            <div class="col-md-8"><span class="profile-value">{{ user.get_full_name }}</span></div>
                        </div>
                        {% endif %}
                        
                        {% if user.phone_number %}
                        <div class="row mb-3 profile-row">
                            <div class="col-md-4"><strong class="profile-label"><i class="fas fa-phone"></i> Phone:</strong></div>
                            <div class="col-md-8"><span class="profile-value">{{ user.phone_number }}</span></div>
                        </div>
                        {% endif %}
                        
                        {% if user.address %}
                        <div class="row mb-3 profile-row">
                            <div class="col-md-4"><strong class="profile-label"><i class="fas fa-map-marker-alt"></i> Address:</strong></div>
                            <div class="col-md-8"><span class="profile-value">{{ user.address }}</span></div>
                        </div>
                        {% endif %}
                        
                        <div class="row mb-3 profile-row">
                            <div class="col-md-4"><strong class="profile-label"><i class="fas fa-calendar"></i> Joined:</strong></div>
                            <div class="col-md-8"><span class="profile-value">{{ user.created_at|date:"M d, Y" }}</span></div>
                        </div>
                        
                        <div class="mt-4 d-grid gap-2 d-md-flex">
                            <a href="{% url 'edit_profile' %}" class="btn btn-primary me-md-2">
                                <i class="fas fa-edit"></i> Edit Profile
                            </a>
                            {% if user.email_verified %}
                            <a href="{% url 'change_password' %}" class="btn btn-dark">
                                <i class="fas fa-key"></i> Change Password
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="text-white">Quick Links</h5>
                    </div>
                    <div class="card-body">
                        {% if user.role == 'customer' %}
                        <a href="{% url 'cart' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-shopping-cart"></i> My Cart
                        </a>
                        <a href="{% url 'customer_orders' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-list"></i> My Orders
                        </a>
                        {% elif user.role == 'staff' %}
                        <a href="{% url 'staff_dashboard' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                        <a href="{% url 'staff_fish_list' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-fish"></i> Manage Fishes
                        </a>
                        {% elif user.role == 'admin' %}
                        <a href="{% url 'admin_gallery' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-photo-video"></i> Gallery
                        </a>
                        <a href="{% url 'admin_limited_offers' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-bolt"></i> Limited Offers
                        </a>
                        <a href="{% url 'admin_combo_deals' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-layer-group"></i> Combo Deals
                        </a>
                        <a href="{% url 'admin_coupons' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-ticket-alt"></i> Manage Coupons
                        </a>
                        <a href="{% url 'admin_shipping_charges' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-truck-loading"></i> Shipping Charges
                        </a>
                        <a href="{% url 'admin_reviews' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-star-half-alt"></i> Moderate Reviews
                        </a>
                        <a href="{% url 'admin_orders' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-shopping-bag"></i> Orders
                        </a>
                        <a href="{% url 'admin_users' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-users"></i> Users
                        </a>
                        <a href="{% url 'admin_services' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            Services
                        </a>
                        <a href="{% url 'admin_contact' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-address-book"></i> Contact Info
                        </a>
                        <a href="{% url 'admin_blogs' %}" class="btn btn-outline-primary w-100 mb-2" style="border-color: var(--accent-blue); color: var(--accent-light-blue);">
                            <i class="fas fa-newspaper"></i> Blogs
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function(){
    const btn = document.getElementById('profileThemeToggle');
    const root = document.documentElement;
    const labelEl = btn ? btn.querySelector('.label') : null;
    const STORAGE_KEY = 'theme';

    function currentTheme(){
        return root.getAttribute('data-theme') || 'dark';
    }
    function setTheme(theme){
        root.setAttribute('data-theme', theme);
        try { localStorage.setItem(STORAGE_KEY, theme); } catch(e) {}
        if (btn && labelEl){
            const isLight = theme === 'light';
            labelEl.textContent = isLight ? 'Light' : 'Dark';
            const icon = btn.querySelector('i');
            if (icon) icon.className = isLight ? 'fas fa-sun me-2' : 'fas fa-moon me-2';
        }
    }
    // Initialize button state
    setTheme(currentTheme());
    if (btn){
        btn.addEventListener('click', function(ev){
            ev.preventDefault();
            const nxt = currentTheme() === 'dark' ? 'light' : 'dark';
            setTheme(nxt);
        });
    }
});
</script>
{% endblock %}
